<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lalka ‚Ä¢ Matura | ViralloLab</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Outfit:wght@300;400;500;600;700&display=swap">
  <style>


        :root {
            color-scheme: dark;
            --bg-dark: #0d0d12;
            --bg-card: #14141c;
            --bg-elevated: #1c1c28;
            --text-primary: #f0f0f5;
            --text-secondary: #a0a0b5;
            --text-muted: #606075;
            --accent-red: #22c55e;
            --accent-orange: #f97316;
            --accent-gold: #eab308;
            --accent-purple: #a855f7;
            --accent-blue: #3b82f6;
            --accent-green: #22c55e;
            --gradient-fire: linear-gradient(135deg, #22c55e 0%, #f97316 50%, #eab308 100%);
            --gradient-apocalypse: linear-gradient(135deg, #06140d 0%, #0b1a14 50%, #0d0d12 100%);
            --border-subtle: rgba(255, 255, 255, 0.06);
            --border-accent: rgba(34, 197, 94, 0.45);
            --glow-fire: 0 0 60px rgba(34, 197, 94, 0.25);
            --radius-sm: 8px;
            --radius-md: 16px;
            --radius-lg: 24px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.7;
            overflow-x: hidden;
        }
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: var(--bg-elevated); border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-red); }

        /* Animated fire background */
    .bg-animation {
        position: fixed;
        inset: 0;
        z-index: -1;
        overflow: hidden;
        background: var(--gradient-apocalypse);
    }
    .bg-flames {
        position: absolute;
        bottom: -50%;
        left: -10%;
        width: 120%;
        height: 100%;
        background: radial-gradient(ellipse at bottom, rgba(34, 197, 94, 0.14) 0%, transparent 70%);
        animation: flicker 3s ease-in-out infinite alternate;
    }
    @keyframes flicker {
        0% { opacity: 0.3; transform: scale(1); }
        100% { opacity: 0.5; transform: scale(1.05); }
    }

    /* Navigation */
    .nav {
        position: fixed;
        top: 0; left: 0; right: 0;
        z-index: 1000;
        padding: 1rem 2rem;
        background: rgba(13, 13, 18, 0.9);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--border-subtle);
    }
    .nav-container {
        max-width: 1400px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .nav-logo {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        text-decoration: none;
        color: var(--text-primary);
    }
    .nav-logo-icon {
        width: 44px; height: 44px;
        background: var(--gradient-fire);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }
    .nav-logo-text {
        font-family: 'Cinzel', serif;
        font-weight: 700;
        font-size: 1.3rem;
        letter-spacing: 0.05em;
    }
    .nav-logo-text span { color: var(--accent-red); }
    .nav-links {
        display: flex;
        gap: 0.5rem;
        list-style: none;
    }
    .nav-link {
        color: var(--text-secondary);
        text-decoration: none;
        padding: 0.5rem 1rem;
        border-radius: var(--radius-sm);
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.3s ease;
    }
    .nav-link:hover { color: var(--text-primary); background: var(--bg-elevated); }
    .nav-progress {
        position: absolute;
        bottom: 0; left: 0;
        height: 2px;
        background: var(--gradient-fire);
        width: 0%;
        transition: width 0.1s ease;
    }

    /* Hero */
    .hero {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 8rem 2rem 4rem;
        position: relative;
    }
    .hero::before {
        content: 'üî•';
        position: absolute;
        font-size: 15rem;
        opacity: 0.05;
        top: 20%;
        animation: pulse 4s ease-in-out infinite;
    }
    @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 0.05; }
        50% { transform: scale(1.1); opacity: 0.08; }
    }
    .hero-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: var(--bg-elevated);
        border: 1px solid var(--border-accent);
        border-radius: 50px;
        font-size: 0.85rem;
        color: var(--accent-red);
        margin-bottom: 2rem;
        animation: fadeInDown 1s ease-out;
    }
    .hero-title {
        font-family: 'Cinzel', serif;
        font-size: clamp(3rem, 12vw, 7rem);
        font-weight: 700;
        line-height: 1.1;
        margin-bottom: 0.5rem;
        animation: fadeInUp 1s ease-out 0.2s both;
        letter-spacing: 0.05em;
    }
    .hero-title .highlight {
        background: var(--gradient-fire);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    .hero-author {
        font-family: 'Crimson Text', serif;
        font-size: 1.5rem;
        font-style: italic;
        color: var(--text-secondary);
        margin-bottom: 1.5rem;
        animation: fadeInUp 1s ease-out 0.3s both;
    }
    .hero-subtitle {
        font-size: 1.1rem;
        color: var(--text-secondary);
        max-width: 600px;
        margin-bottom: 3rem;
        animation: fadeInUp 1s ease-out 0.4s both;
    }
    .hero-meta {
        display: flex;
        gap: 2rem;
        flex-wrap: wrap;
        justify-content: center;
        animation: fadeInUp 1s ease-out 0.5s both;
    }
    .meta-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.25rem;
        background: var(--bg-elevated);
        border-radius: 50px;
        font-size: 0.9rem;
    }
    .meta-item span:first-child { font-size: 1.2rem; }
    .hero-actions {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
        animation: fadeInUp 1s ease-out 0.6s both;
    }
    .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
        padding: 1rem 2rem;
        border-radius: 50px;
        font-weight: 600;
        font-size: 1rem;
        text-decoration: none;
        cursor: pointer;
        border: none;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        font-family: 'Outfit', sans-serif;
    }
    .btn-primary {
        background: var(--gradient-fire);
        color: white;
        box-shadow: var(--glow-fire);
    }
    .btn-primary:hover {
        transform: translateY(-4px) scale(1.02);
        box-shadow: 0 0 80px rgba(220, 38, 38, 0.5);
    }
    .btn-secondary {
        background: var(--bg-elevated);
        color: var(--text-primary);
        border: 1px solid var(--border-subtle);
    }
    .btn-secondary:hover { border-color: var(--accent-red); transform: translateY(-2px); }

    @keyframes fadeInDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* Sections */
    section { padding: 6rem 2rem; }
    .container { max-width: 1200px; margin: 0 auto; }
    .section-header { text-align: center; margin-bottom: 4rem; }
    .section-badge {
        display: inline-flex;
        padding: 0.4rem 1rem;
        background: var(--bg-elevated);
        border-radius: 50px;
        font-size: 0.8rem;
        color: var(--accent-red);
        text-transform: uppercase;
        letter-spacing: 0.1em;
        margin-bottom: 1rem;
    }
    .section-title {
        font-family: 'Cinzel', serif;
        font-size: clamp(2rem, 5vw, 3.5rem);
        font-weight: 700;
        margin-bottom: 1rem;
    }
    .section-subtitle {
        font-size: 1.1rem;
        color: var(--text-secondary);
        max-width: 600px;
        margin: 0 auto;
    }
    .reveal {
        opacity: 1;
        transform: translateY(0);
        transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .reveal.active { opacity: 1; transform: translateY(0); }

    /* Author Section */
    .author-section { background: var(--bg-card); border-top: 1px solid var(--border-subtle); }
    .author-card {
        display: grid;
        grid-template-columns: 200px 1fr;
        gap: 3rem;
        background: var(--bg-elevated);
        border-radius: var(--radius-lg);
        padding: 3rem;
        border: 1px solid var(--border-subtle);
    }
    .author-image {
        width: 200px;
        height: 250px;
        background: var(--gradient-fire);
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 5rem;
        position: relative;
        overflow: hidden;
    }
    .author-image::after {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.5), transparent);
    }
    .author-info h3 {
        font-family: 'Cinzel', serif;
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }
    .author-dates {
        color: var(--accent-red);
        font-size: 1.1rem;
        margin-bottom: 1.5rem;
    }
    .author-bio { color: var(--text-secondary); margin-bottom: 1.5rem; }
    .author-facts {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }
    .fact-item {
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
        padding: 1rem;
        background: var(--bg-dark);
        border-radius: var(--radius-sm);
    }
    .fact-icon {
        width: 36px; height: 36px;
        background: rgba(34, 197, 94, 0.14);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }
    .fact-item p { font-size: 0.9rem; color: var(--text-secondary); }
    .fact-item strong { color: var(--text-primary); }

    /* Ekspresjonizm */
    .expressionism-section { background: var(--bg-dark); }
    .expressionism-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
    }
    .exp-card {
        background: var(--bg-elevated);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        padding: 2rem;
        transition: all 0.4s ease;
        position: relative;
        overflow: hidden;
    }
    .exp-card::before {
        content: '';
        position: absolute;
        top: 0; left: 0; right: 0;
        height: 3px;
        background: var(--gradient-fire);
        transform: scaleX(0);
        transition: transform 0.4s ease;
    }
    .exp-card:hover { transform: translateY(-8px); border-color: var(--border-accent); }
    .exp-card:hover::before { transform: scaleX(1); }
    .exp-icon {
        width: 60px; height: 60px;
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.75rem;
        margin-bottom: 1.5rem;
        background: rgba(220, 38, 38, 0.1);
    }
    .exp-card h3 { font-size: 1.25rem; font-weight: 600; margin-bottom: 0.75rem; }
    .exp-card p { color: var(--text-secondary); font-size: 0.95rem; }

    /* Geneza */
    .genesis-section { background: var(--bg-card); }
    .genesis-timeline {
        position: relative;
        max-width: 800px;
        margin: 0 auto;
    }
    .genesis-timeline::before {
        content: '';
        position: absolute;
        left: 50%;
        top: 0;
        bottom: 0;
        width: 2px;
        background: var(--gradient-fire);
        transform: translateX(-50%);
    }
    .timeline-item {
        display: flex;
        gap: 2rem;
        margin-bottom: 3rem;
        position: relative;
    }
    .timeline-item:nth-child(odd) { flex-direction: row-reverse; text-align: right; }
    .timeline-content {
        flex: 1;
        background: var(--bg-elevated);
        padding: 2rem;
        border-radius: var(--radius-md);
        border: 1px solid var(--border-subtle);
    }
    .timeline-dot {
        position: absolute;
        left: 50%;
        top: 2rem;
        width: 20px;
        height: 20px;
        background: var(--accent-red);
        border-radius: 50%;
        transform: translateX(-50%);
        box-shadow: 0 0 20px rgba(220, 38, 38, 0.5);
    }
    .timeline-content h4 {
        font-family: 'Cinzel', serif;
        font-size: 1.25rem;
        color: var(--accent-red);
        margin-bottom: 0.75rem;
    }
    .timeline-content p { color: var(--text-secondary); }

    /* Apokalipsa - znaki */
    .apocalypse-section { background: var(--bg-dark); }
    .apocalypse-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
    }
    .apo-card {
        background: var(--bg-elevated);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        padding: 2rem;
        text-align: center;
        transition: all 0.4s ease;
    }
    .apo-card:hover {
        transform: scale(1.05);
        border-color: var(--accent-red);
        box-shadow: var(--glow-fire);
    }
    .apo-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        display: block;
    }
    .apo-card h4 {
        font-family: 'Cinzel', serif;
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
        color: var(--accent-orange);
    }
    .apo-card p { color: var(--text-secondary); font-size: 0.9rem; }
    .apo-card .srodek {
        font-size: 0.8rem;
        color: var(--accent-purple);
        margin-top: 0.5rem;
        padding: 0.25rem 0.5rem;
        background: rgba(168, 85, 247, 0.1);
        border-radius: 4px;
        display: inline-block;
    }

    /* Obrazy - postacie */
    .characters-section { background: var(--bg-card); }
    .characters-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 2rem;
    }
    .char-card {
        background: var(--bg-elevated);
        border-radius: var(--radius-lg);
        overflow: hidden;
        border: 1px solid var(--border-subtle);
        transition: all 0.4s ease;
    }
    .char-card:hover { transform: translateY(-8px); border-color: var(--border-accent); }
    .char-header {
        padding: 1.5rem;
        background: var(--gradient-fire);
        position: relative;
    }
    .char-header h4 {
        font-family: 'Cinzel', serif;
        font-size: 1.5rem;
        color: white;
    }
    .char-header .char-icon {
        position: absolute;
        right: 1.5rem;
        top: 50%;
        transform: translateY(-50%);
        font-size: 2.5rem;
        opacity: 0.5;
    }
    .char-body { padding: 1.5rem; }
    .char-body p { color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.95rem; }
    .char-traits {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    .trait {
        padding: 0.35rem 0.75rem;
        background: var(--bg-dark);
        border-radius: 50px;
        font-size: 0.8rem;
        color: var(--accent-gold);
        border: 1px solid rgba(234, 179, 8, 0.2);
    }

    /* ≈örodki stylistyczne */
    .devices-section { background: var(--bg-dark); }
    .devices-tabs {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        margin-bottom: 3rem;
        flex-wrap: wrap;
    }
    .device-tab {
        padding: 0.75rem 1.5rem;
        background: var(--bg-elevated);
        border: 1px solid var(--border-subtle);
        border-radius: 50px;
        color: var(--text-secondary);
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Outfit', sans-serif;
    }
    .device-tab:hover { color: var(--text-primary); border-color: var(--accent-red); }
    .device-tab.active { background: var(--gradient-fire); color: white; border-color: transparent; }
    .devices-content {
        display: none;
        background: var(--bg-elevated);
        border-radius: var(--radius-lg);
        padding: 2rem;
        border: 1px solid var(--border-subtle);
    }
    .devices-content.active { display: block; animation: fadeIn 0.4s ease; }
    .device-example {
        background: var(--bg-dark);
        border-left: 4px solid var(--accent-red);
        padding: 1.5rem;
        margin: 1rem 0;
        border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
    }
    .device-example blockquote {
        font-family: 'Crimson Text', serif;
        font-size: 1.2rem;
        font-style: italic;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }
    .device-example cite {
        font-size: 0.85rem;
        color: var(--text-muted);
    }

    /* Quiz */
    .quiz-section { background: var(--bg-card); }
    .quiz-container { max-width: 800px; margin: 0 auto; }
    .quiz-progress { display: flex; gap: 0.5rem; margin-bottom: 2rem; }
    .quiz-progress-dot {
        flex: 1;
        height: 4px;
        background: var(--bg-elevated);
        border-radius: 2px;
        transition: background 0.3s ease;
    }
    .quiz-progress-dot.completed { background: var(--accent-green); }
    .quiz-progress-dot.current { background: var(--accent-red); }
    .quiz-card {
        background: var(--bg-elevated);
        border-radius: var(--radius-lg);
        padding: 3rem;
        border: 1px solid var(--border-subtle);
    }
    .quiz-question-number {
        font-size: 0.85rem;
        color: var(--accent-red);
        text-transform: uppercase;
        letter-spacing: 0.1em;
        margin-bottom: 1rem;
    }
    .quiz-question {
        font-family: 'Cinzel', serif;
        font-size: 1.5rem;
        margin-bottom: 2rem;
        line-height: 1.4;
    }
    .quiz-options { display: flex; flex-direction: column; gap: 1rem; }
    .quiz-option {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1.25rem;
        background: var(--bg-dark);
        border: 2px solid var(--border-subtle);
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: all 0.3s ease;
    }
    .quiz-option:hover { border-color: var(--accent-red); }
    .quiz-option.selected { border-color: var(--accent-red); background: rgba(220, 38, 38, 0.1); }
    .quiz-option.correct { border-color: var(--accent-green); background: rgba(34, 197, 94, 0.1); }
    .quiz-option.incorrect { border-color: #ef4444; background: rgba(239, 68, 68, 0.1); }
    .option-letter {
        width: 36px; height: 36px;
        border-radius: 50%;
        background: var(--bg-elevated);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        flex-shrink: 0;
    }
    .quiz-option.selected .option-letter { background: var(--accent-red); color: white; }
    .quiz-option.correct .option-letter { background: var(--accent-green); color: white; }
    .quiz-option.incorrect .option-letter { background: #ef4444; color: white; }
    .quiz-feedback {
        margin-top: 2rem;
        padding: 1.5rem;
        border-radius: var(--radius-md);
        display: none;
    }
    .quiz-feedback.show { display: block; animation: fadeIn 0.4s ease; }
    .quiz-feedback.correct { background: rgba(34, 197, 94, 0.1); border: 1px solid var(--accent-green); }
    .quiz-feedback.incorrect { background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; }
    .quiz-feedback h4 { font-size: 1.1rem; margin-bottom: 0.5rem; }
    .quiz-feedback.correct h4 { color: var(--accent-green); }
    .quiz-feedback.incorrect h4 { color: #ef4444; }
    .quiz-feedback p { color: var(--text-secondary); font-size: 0.95rem; }
    .quiz-actions { display: flex; justify-content: space-between; margin-top: 2rem; }
    .quiz-score { text-align: center; padding: 3rem; }
    .quiz-score-value {
        font-family: 'Cinzel', serif;
        font-size: 5rem;
        font-weight: 700;
        background: var(--gradient-fire);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    .quiz-score-label { font-size: 1.25rem; color: var(--text-secondary); margin-bottom: 2rem; }

    /* Flashcards */
    .flashcards-section { background: var(--bg-dark); }
    .flashcard-container {
        max-width: 600px;
        margin: 0 auto;
        perspective: 1000px;
    }
    .flashcard {
        width: 100%;
        height: 350px;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 0.6s ease;
        cursor: pointer;
    }
    .flashcard.flipped { transform: rotateY(180deg); }
    .flashcard-face {
        position: absolute;
        inset: 0;
        backface-visibility: hidden;
        border-radius: var(--radius-lg);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 3rem;
        text-align: center;
    }
    .flashcard-front {
        background: var(--bg-elevated);
        border: 2px solid var(--accent-red);
    }
    .flashcard-back {
        background: var(--gradient-fire);
        transform: rotateY(180deg);
    }
    .flashcard-front h3 {
        font-family: 'Cinzel', serif;
        font-size: 1.75rem;
        margin-bottom: 1rem;
    }
    .flashcard-front p { color: var(--text-muted); font-size: 0.9rem; }
    .flashcard-back p {
        color: white;
        font-size: 1.25rem;
        line-height: 1.6;
    }
    .flashcard-nav {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-top: 2rem;
    }
    .flashcard-counter {
        text-align: center;
        margin-top: 1rem;
        color: var(--text-muted);
    }

    /* Summary */
    .summary-section { background: var(--bg-card); }
    .summary-card {
        background: var(--bg-elevated);
        border-radius: var(--radius-lg);
        padding: 3rem;
        border: 1px solid var(--border-subtle);
    }
    .summary-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 2rem;
    }
    .summary-item h4 {
        font-family: 'Cinzel', serif;
        color: var(--accent-red);
        margin-bottom: 0.75rem;
        font-size: 1.1rem;
    }
    .summary-item p { color: var(--text-secondary); font-size: 0.95rem; }

    /* Footer */
    footer {
        padding: 4rem 2rem;
        background: var(--bg-dark);
        border-top: 1px solid var(--border-subtle);
        text-align: center;
    }
    .footer-logo {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        margin-bottom: 1rem;
    }
    .footer-logo-icon {
        width: 40px; height: 40px;
        background: var(--gradient-fire);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
    }
    .footer-logo-text {
        font-family: 'Cinzel', serif;
        font-size: 1.25rem;
        font-weight: 700;
    }
    .footer-copy { color: var(--text-muted); font-size: 0.85rem; }

    /* Responsive */
    @media (max-width: 1024px) {
        .author-card { grid-template-columns: 1fr; }
        .author-image { width: 150px; height: 180px; margin: 0 auto; }
        .timeline-item, .timeline-item:nth-child(odd) { flex-direction: column; text-align: left; }
        .genesis-timeline::before { left: 20px; }
        .timeline-dot { left: 20px; }
    }
    @media (max-width: 768px) {
        .nav-links { display: none; }
        .hero-meta { flex-direction: column; align-items: center; }
        .author-facts { grid-template-columns: 1fr; }
        .quiz-card { padding: 2rem; }
        section { padding: 4rem 1.5rem; }
        .flashcard { height: 300px; }
    }
    

/* --- Lesson-specific components (Deutsch: Essen) --- */
.pill-tabs{display:flex;flex-wrap:wrap;gap:.5rem;justify-content:center;margin:2rem auto 1.5rem;}
.pill-tab{padding:.6rem 1.1rem;border-radius:999px;background:var(--bg-elevated);border:1px solid var(--border-subtle);color:var(--text-secondary);cursor:pointer;font-weight:600;transition:all .25s ease;user-select:none;}
.pill-tab:hover{transform:translateY(-1px);border-color:rgba(234,179,8,.35);color:var(--text-primary);}
.pill-tab.active{background:var(--gradient-fire);border-color:transparent;color:#0d0d12;}
.vocab-top{display:flex;flex-wrap:wrap;gap:1rem;justify-content:space-between;align-items:center;margin:1rem 0 1.5rem;}
.progress-wrap{flex:1;min-width:220px;}
.progress-label{display:flex;justify-content:space-between;align-items:center;color:var(--text-secondary);font-size:.9rem;margin-bottom:.5rem;}
.progress-bar{width:100%;height:10px;border-radius:999px;background:rgba(255,255,255,.06);overflow:hidden;border:1px solid var(--border-subtle);}
.progress-fill{height:100%;width:0%;background:var(--gradient-fire);transition:width .35s ease;}
.mini-tools{display:flex;flex-wrap:wrap;gap:.75rem;justify-content:flex-end;}
.input{background:rgba(255,255,255,.04);border:1px solid var(--border-subtle);border-radius:999px;padding:.7rem 1rem;color:var(--text-primary);outline:none;min-width:240px;}
.input:focus{border-color:rgba(234,179,8,.45);box-shadow:0 0 0 6px rgba(234,179,8,.08);}
.vocab-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1rem;margin-top:1.25rem;}
.vocab-card{background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:var(--radius-md);padding:1.25rem;position:relative;overflow:hidden;transition:all .25s ease;}
.vocab-card:hover{transform:translateY(-3px);border-color:rgba(234,179,8,.25);}
.vocab-card.mastered{border-color:rgba(34,197,94,.45);box-shadow:0 0 0 1px rgba(34,197,94,.1) inset;}
.vocab-head{display:flex;align-items:flex-start;justify-content:space-between;gap:.75rem;margin-bottom:.75rem;}
.vocab-word{font-family:'Cinzel',serif;font-weight:700;font-size:1.15rem;line-height:1.25;}
.vocab-sub{color:var(--text-secondary);font-size:.9rem;margin-top:.25rem;}
.vocab-actions{display:flex;gap:.5rem;}
.icon-btn{width:40px;height:40px;border-radius:12px;border:1px solid var(--border-subtle);background:rgba(255,255,255,.03);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;user-select:none;}
.icon-btn:hover{transform:translateY(-1px);border-color:rgba(234,179,8,.35);}
.icon-btn.good{border-color:rgba(34,197,94,.35);}
.vocab-body{color:var(--text-secondary);font-size:.95rem;}
.hint-row{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.75rem;}
.chip{font-size:.78rem;padding:.25rem .55rem;border-radius:999px;background:rgba(255,255,255,.05);border:1px solid var(--border-subtle);color:var(--text-secondary);}
.chip.gold{border-color:rgba(234,179,8,.35);color:rgba(234,179,8,.95);background:rgba(234,179,8,.08);}
.exercise-card{background:var(--bg-elevated);border:1px solid var(--border-subtle);border-radius:var(--radius-md);padding:1.5rem;margin-top:1.5rem;}
.exercise-title{font-family:'Cinzel',serif;font-weight:700;margin-bottom:.75rem;}
.fill-line{color:var(--text-primary);font-size:1.05rem;line-height:1.9;}
select.fill-select{background:rgba(255,255,255,.04);border:1px solid var(--border-subtle);border-radius:10px;padding:.35rem .5rem;color:var(--text-primary);margin:0 .25rem;outline:none;}
select.fill-select.correct{border-color:rgba(34,197,94,.55);background:rgba(34,197,94,.08);}
select.fill-select.wrong{border-color:rgba(220,38,38,.55);background:rgba(220,38,38,.08);}

/* Ujednolicone dropdowny pod ciemny motyw */
select{color-scheme: dark;}
select option{background:#0b0d13;color:var(--text-primary);}
.dialog-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1rem;margin-top:1.25rem;}
.dialog-q{color:var(--text-primary);font-weight:600;margin-bottom:.75rem;}
.option-list{display:flex;flex-direction:column;gap:.6rem;}
.option-btn{background:rgba(255,255,255,.03);border:1px solid var(--border-subtle);color:var(--text-primary);padding:.75rem .85rem;border-radius:14px;cursor:pointer;text-align:left;transition:all .2s ease;}
.option-btn:hover{transform:translateY(-1px);border-color:rgba(234,179,8,.35);}
.option-btn.correct{border-color:rgba(34,197,94,.55);background:rgba(34,197,94,.08);}
.option-btn.wrong{border-color:rgba(220,38,38,.55);background:rgba(220,38,38,.08);}
.dialog-feedback{margin-top:.9rem;font-size:.9rem;color:var(--text-secondary);}
.typing-wrap{display:grid;grid-template-columns:1.1fr .9fr;gap:1rem;align-items:start;margin-top:1.25rem;}
.typing-card{background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:var(--radius-md);padding:1.5rem;}
.typing-prompt{font-family:'Cinzel',serif;font-size:1.4rem;margin-bottom:.5rem;}
.typing-hint{color:var(--text-secondary);margin-bottom:1rem;}
.typing-input{width:100%;border-radius:14px;padding:.9rem 1rem;font-size:1.05rem;background:rgba(255,255,255,.04);border:1px solid var(--border-subtle);color:var(--text-primary);outline:none;}
.typing-input:focus{border-color:rgba(234,179,8,.45);box-shadow:0 0 0 6px rgba(234,179,8,.08);}
.stat-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:.75rem;margin-top:1rem;}
.stat{background:rgba(255,255,255,.03);border:1px solid var(--border-subtle);border-radius:14px;padding:.9rem;}
.stat .k{color:var(--text-secondary);font-size:.85rem;}
.stat .v{font-family:'Cinzel',serif;font-size:1.4rem;margin-top:.25rem;}
.toast{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);background:rgba(20,20,28,.95);border:1px solid var(--border-subtle);padding:.85rem 1rem;border-radius:14px;color:var(--text-primary);z-index:2000;opacity:0;pointer-events:none;transition:opacity .25s ease,transform .25s ease;}
.toast.show{opacity:1;transform:translateX(-50%) translateY(-4px);}
.toast small{color:var(--text-secondary);display:block;margin-top:.15rem;}
@media (max-width:900px){.typing-wrap{grid-template-columns:1fr;}.input{min-width:180px;width:100%;}.mini-tools{justify-content:flex-start;}}

    

/* --- LALKA overrides (minimal) --- */
.hero::before { content: 'üé©'; }

/* --- Components used in LALKA page (tabs + stats + code) --- */
.tab-row{
  display:flex;
  gap:.6rem;
  flex-wrap:wrap;
  margin-bottom: 1rem;
}
.tab-btn{
  appearance:none;
  border:none;
  cursor:pointer;
  padding:.7rem 1rem;
  border-radius: 999px;
  background: rgba(255,255,255,.06);
  color: var(--text-secondary);
  border: 1px solid var(--border-subtle);
  transition: var(--transition);
  font-weight: 700;
}
.tab-btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.09); color: var(--text-primary); }
.tab-btn.active{
  background: linear-gradient(135deg, rgba(168,85,247,.25), rgba(234,179,8,.18));
  color: var(--text-primary);
  border-color: rgba(168,85,247,.5);
  box-shadow: 0 0 0 6px rgba(168,85,247,.08);
}
.tab-panel{
  background: rgba(0,0,0,.22);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-md);
  padding: 1rem 1.1rem;
}
.code{
  font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
  font-size: .92rem;
  line-height: 1.7;
  padding: 1rem 1.1rem;
  border-radius: 14px;
  background: rgba(0,0,0,.28);
  border: 1px solid var(--border-subtle);
  color: var(--text-primary);
}
.stat-grid{
  display:grid;
  grid-template-columns: repeat(2, minmax(0,1fr));
  gap: .75rem;
  margin-top: .8rem;
}
.stat{
  background: rgba(255,255,255,.05);
  border: 1px solid var(--border-subtle);
  border-radius: 14px;
  padding: .85rem .95rem;
}
.stat .k{ color: var(--text-secondary); font-size: .9rem; }
.stat .v{ font-family:'Cinzel',serif; font-size: 1.5rem; margin-top:.15rem; }
@media (max-width: 520px){
  .stat-grid{ grid-template-columns: 1fr; }
}

  
/* Accordion (rozszerzone streszczenie) */
.accordion{display:grid;gap:.75rem;margin-top:.9rem;}
.acc-item{background:rgba(255,255,255,.03);border:1px solid var(--border-subtle);border-radius:16px;padding:.9rem 1rem;}
.acc-item summary{cursor:pointer;list-style:none;font-weight:700;color:var(--text-primary);display:flex;align-items:center;gap:.5rem;}
.acc-item summary::-webkit-details-marker{display:none;}
.acc-item[open]{border-color:rgba(34,197,94,.35);box-shadow:0 0 0 6px rgba(34,197,94,.08);}
.acc-body{margin-top:.75rem;color:var(--text-secondary);line-height:1.65;}
.acc-body ul{margin:.4rem 0 0 1.1rem;}
.acc-body li{margin:.25rem 0;}

  </style>
</head>
<body id="top">
<div class="bg-animation">
<div class="bg-flames"></div>
</div>
<div class="nav-progress" id="navProgress"></div>
<nav class="nav">
  <div class="nav-container">
    <a class="nav-logo" href="#top" aria-label="Start">
      <div class="nav-logo-icon">üìö</div>
      <div class="nav-logo-text">Lalka <span>Matura</span></div>
    </a>
    <ul class="nav-links">
      <li><a class="nav-link" href="#omowienie">Om√≥wienie</a></li>
      <li><a class="nav-link" href="#streszczenie">Streszczenie</a></li>
      <li><a class="nav-link" href="#bohaterowie">Bohaterowie</a></li>
      <li><a class="nav-link" href="#motywy">Motywy</a></li>
      <li><a class="nav-link" href="#generator">Generator</a></li>
      <li><a class="nav-link" href="#quiz">Quiz</a></li>
      <li><a class="nav-link" href="#fiszki">Fiszki</a></li>
      <li><a class="nav-link" href="#typing">Typing</a></li>
    </ul>
  </div>
</nav>

<section class="hero">
  <div class="hero-badge">üìå Pozytywizm ‚Ä¢ lektura obowiƒÖzkowa ‚Ä¢ pod maturƒô</div>
  <h1 class="hero-title">LALKA</h1>
  <p class="hero-subtitle">
    Szybkie om√≥wienie + najwa≈ºniejsze motywy + ƒáwiczenia utrwalajƒÖce (quiz, fiszki, typing).<br/>
    Zrobione tak, ≈ºeby≈õ w 20‚Äì30 minut mia≈Ç/a ‚Äûszkielet‚Äù do rozprawki.
  </p>
  <div class="hero-cta">
    <a class="btn btn-primary" href="#generator">Odpal generator tezy</a>
    <a class="btn btn-secondary" href="#quiz">Sprawd≈∫ quiz</a>
  </div>
</section>

<section class="author-section" id="omowienie">
  <div class="container">
    <div class="section-header reveal">
      <div class="section-badge">üß† W pigu≈Çce</div>
      <h2 class="section-title">Om√≥wienie: co musisz umieƒá</h2>
      <p class="section-subtitle">Je≈õli umiesz te punkty ‚Äî jeste≈õ bezpieczny/a na 70‚Äì80% pyta≈Ñ.</p>
    </div>

    <div class="exercise-card reveal">
      <div class="exercise-title">üéØ 10 fakt√≥w ‚Äûmust know‚Äù</div>
      <ul class="option-list" style="gap: .6rem;">
        <li class="option-item">Autor: <b>Boles≈Çaw Prus</b> (pozytywizm, realizm).</li>
        <li class="option-item">Gatunek: <b>powie≈õƒá realistyczna</b> z elementami panoramy spo≈Çecznej.</li>
        <li class="option-item">O≈õ konfliktu: <b>romantyczny idealizm</b> vs <b>pozytywistyczny pragmatyzm</b>.</li>
        <li class="option-item">Bohater: <b>Stanis≈Çaw Wokulski</b> ‚Äî ‚Äûcz≈Çowiek przej≈õcia‚Äù miƒôdzy epokami.</li>
        <li class="option-item">Mi≈Ço≈õƒá do <b>Izabeli ≈Åƒôckiej</b> jako motor dzia≈Ça≈Ñ + ≈∫r√≥d≈Ço klƒôski.</li>
        <li class="option-item">Awans spo≈Çeczny i pieniƒÖdz: <b>handel / kapita≈Ç</b> vs <b>arystokracja</b>.</li>
        <li class="option-item">‚ÄûPamiƒôtnik starego subiekta‚Äù = perspektywa <b>Ignacego Rzeckiego</b> (romantyk, idealista).</li>
        <li class="option-item">WƒÖtek nauki i postƒôpu: <b>Julian Ochocki</b> (marzenie o wynalazkach, modernizacji).</li>
        <li class="option-item">Obraz spo≈Çecze≈Ñstwa: arystokracja, mieszcza≈Ñstwo, inteligencja, bieda (Warszawa).</li>
        <li class="option-item">Fina≈Ç (wa≈ºne): nie ‚Äûkto z kim‚Äù, tylko <b>co zostaje w bohaterze</b> ‚Äî rozpad z≈Çudze≈Ñ, pytanie o sens.</li>
      </ul>
    </div>

    <div class="exercise-card reveal">
      <div class="exercise-title">üí• Killer: ‚ÄûTr√≥jkƒÖt maturalny‚Äù</div>
      <p class="fill-line" style="margin:0;">
        Gdy dostajesz temat ‚Äî zawsze odpowiedz 3 rzeczy: <b>teza</b> (co udowodniƒô), <b>argument</b> (jak), <b>przyk≈Çad</b> (gdzie w ‚ÄûLalce‚Äù to widaƒá).
        Poni≈ºej masz generator, kt√≥ry robi to za Ciebie i uczy schematu.
      </p>
    </div>
  </div>
</section>

<section class="author-section" id="streszczenie">
  <div class="container">
    <div class="section-header reveal">
      <div class="section-badge">üó∫Ô∏è O≈õ fabu≈Çy</div>
      <h2 class="section-title">Streszczenie turbo (bez lania wody)</h2>
      <p class="section-subtitle">Dwie ≈õcie≈ºki: ‚Äûtu i teraz‚Äù + wspomnienia Rzeckiego.</p>
    </div>

    <div class="dialog-grid reveal">
      <div class="exercise-card" style="margin-top:0;">
        <div class="exercise-title">üìç Linia g≈Ç√≥wna (Warszawa)</div>
        <div class="fill-line">
          Wokulski wraca do Warszawy jako bogaty kupiec, wchodzi w ≈õwiat arystokracji i zakochuje siƒô w Izabeli.
          Pr√≥buje ‚Äûkupiƒá‚Äù wej≈õcie do jej ≈õrodowiska (inwestycje, sp√≥≈Çki, teatr), a przy okazji poznaje brutalnƒÖ hierarchiƒô i cynizm elit.
          Z czasem widzi, ≈ºe jego uczucie jest wykorzystywane, a ‚Äûklasa‚Äù nie chce go naprawdƒô dopu≈õciƒá.
        </div>
      </div>

      <div class="exercise-card" style="margin-top:0;">
        <div class="exercise-title">üìì Pamiƒôtnik Rzeckiego (t≈Ço epoki)</div>
        <div class="fill-line">
          Rzecki opisuje swojƒÖ m≈Çodo≈õƒá, idee, wiarƒô w ‚ÄûwielkƒÖ politykƒô‚Äù i romantyczne mity. Dziƒôki temu widaƒá,
          skƒÖd bierze siƒô tƒôsknota za sensem i dlaczego Wokulski jest rozdarty: z jednej strony praca i pieniƒÖdz,
          z drugiej ‚Äî marzenia i potrzeba wielkiego uczucia.
        </div>
      </div>
    </div>

    <div class="exercise-card reveal">
      <div class="exercise-title">üß© Uzupe≈Çnij streszczenie (1 minuta)</div>
      <p class="fill-line">
        Wokulski dorabia siƒô na <select class="fill-select" data-answer="dostawach wojennych">
          <option value="">‚Äî wybierz ‚Äî</option>
          <option>dostawach wojennych</option>
          <option>wygranej na loterii</option>
          <option>spadku po ≈Åƒôckich</option>
        </select>,
        wraca do <select class="fill-select" data-answer="Warszawy">
          <option value="">‚Äî wybierz ‚Äî</option>
          <option>Warszawy</option>
          <option>Krakowa</option>
          <option>Wilna</option>
        </select>
        i pr√≥buje zdobyƒá <select class="fill-select" data-answer="Izabelƒô ≈ÅƒôckƒÖ">
          <option value="">‚Äî wybierz ‚Äî</option>
          <option>Izabelƒô ≈ÅƒôckƒÖ</option>
          <option>paniƒÖ StawskƒÖ</option>
          <option>prezesowƒÖ Zas≈ÇawskƒÖ</option>
        </select>.
        Rzecki patrzy na ≈õwiat jak <select class="fill-select" data-answer="romantyk">
          <option value="">‚Äî wybierz ‚Äî</option>
          <option>romantyk</option>
          <option>scjentysta</option>
          <option>nihilista</option>
        </select>, a Ochocki wierzy w <select class="fill-select" data-answer="postƒôp i naukƒô">
          <option value="">‚Äî wybierz ‚Äî</option>
          <option>postƒôp i naukƒô</option>
          <option>magiczne znaki</option>
          <option>powr√≥t monarchii</option>
        </select>.
      </p>
      <div style="display:flex; gap:.75rem; flex-wrap:wrap; margin-top: 1rem;">
        <button class="btn btn-primary" onclick="checkFill()">Sprawd≈∫ ‚úì</button>
        <button class="btn btn-secondary" onclick="resetFill()">Reset</button>
      </div>
      <p id="fillFeedback" style="margin-top: .9rem; color: var(--text-secondary);"></p>
    </div>
  </div>

      <div class="exercise-card reveal">
        <div class="exercise-title">üìö Rozszerzone streszczenie (sceny pod maturƒô)</div>
        <div class="exercise-desc">Kliknij segment ‚Äî dostajesz ‚Äûco siƒô dzieje‚Äù + ‚Äûpo co to jest‚Äù (pod argument).</div>

        <div class="accordion">
          <details class="acc-item">
            <summary>1) Start: Warszawa, sklep, ‚Äûwej≈õcie‚Äù Wokulskiego</summary>
            <div class="acc-body">
              <ul>
                <li>Wokulski wraca jako bogaty kupiec: praca + handel + kapita≈Ç.</li>
                <li>Poznaje Izabelƒô i wpada w idealizacjƒô (romantyczne patrzenie na arystokracjƒô).</li>
                <li>Sklep = symbol awansu i ‚Äûnowej klasy‚Äù, kt√≥ra chce byƒá uznana.</li>
                <li><b>Pod tezƒô:</b> uczucie zderza siƒô z hierarchiƒÖ spo≈ÇecznƒÖ ‚Äî ‚Äûnie wystarczy byƒá dobrym i bogatym‚Äù.</li>
              </ul>
            </div>
          </details>

          <details class="acc-item">
            <summary>2) Rozw√≥j: ‚Äûkupowanie‚Äù akceptacji, sp√≥≈Çki, salony</summary>
            <div class="acc-body">
              <ul>
                <li>Wokulski inwestuje, wspiera ≈Åƒôckich, wchodzi w towarzystwo ‚Äî ale jest traktowany z g√≥ry.</li>
                <li>Arystokracja bywa paso≈ºytnicza: ≈ºyje pozorami i d≈Çugami, liczy na cudze pieniƒÖdze.</li>
                <li>Rzecki prowadzi pamiƒôtnik ‚Äî t≈Çumaczy epokƒô, ideologie, tƒôsknoty.</li>
                <li><b>Pod tezƒô:</b> pieniƒÖdz otwiera drzwi, ale nie daje szacunku ‚Äî konflikt klasowy dzia≈Ça jak beton.</li>
              </ul>
            </div>
          </details>

          <details class="acc-item">
            <summary>3) Pƒôkniƒôcie: zazdro≈õƒá, upokorzenia, utrata z≈Çudze≈Ñ</summary>
            <div class="acc-body">
              <ul>
                <li>Wokulski widzi, ≈ºe Izabela gra, korzysta z jego pozycji i nie traktuje go jak r√≥wnego.</li>
                <li>Pojawia siƒô wƒÖtek Starskiego ‚Äî wyzwala w Wokulskim gniew, rozpacz, decyzje skrajne.</li>
                <li>Ochocki to kontrast: nauka, postƒôp, przysz≈Ço≈õƒá ‚Äî bez salonowej gry.</li>
                <li><b>Pod tezƒô:</b> idealizm bez granic prowadzi do autodestrukcji; rozum przegrywa z uczuciem.</li>
              </ul>
            </div>
          </details>

          <details class="acc-item">
            <summary>4) Fina≈Ç: co zostaje po Wokulskim (i dlaczego to ‚Äûmaturalne‚Äù)</summary>
            <div class="acc-body">
              <ul>
                <li>Wokulski znika ‚Äî zostaje pytanie: pora≈ºka jednostki czy pora≈ºka systemu?</li>
                <li>Rzecki przegrywa ze zmianƒÖ epoki (stare idea≈Çy nie pasujƒÖ do nowego ≈õwiata).</li>
                <li>U Prusa fina≈Ç jest celowo ‚Äûotwarty‚Äù ‚Äî mo≈ºesz go interpretowaƒá pod tezƒô.</li>
                <li><b>Pod tezƒô:</b> krytyka spo≈Çecze≈Ñstwa i mechanizm√≥w klasowych + dramat cz≈Çowieka rozdartego miƒôdzy romantyzmem a pozytywizmem.</li>
              </ul>
            </div>
          </details>
        </div>
      </div>
</section>

<section class="vocab-section" id="bohaterowie">
  <div class="container">
    <div class="section-header reveal">
      <div class="section-badge">üë• Postacie</div>
      <h2 class="section-title">Bohaterowie (maturalnie)</h2>
      <p class="section-subtitle">Kliknij kartƒô, ≈ºeby rozwinƒÖƒá ‚Äûjak tego u≈ºyƒá w rozprawce‚Äù.</p>
    </div>

    <div class="vocab-grid" id="charGrid"></div>
  </div>
</section>

<section class="author-section" id="motywy">
  <div class="container">
    <div class="section-header reveal">
      <div class="section-badge">üß© Motywy</div>
      <h2 class="section-title">Motywy i problemy</h2>
      <p class="section-subtitle">Wybierz motyw ‚Äî dostajesz gotowƒÖ formu≈Çkƒô ‚Äûpod tezƒô‚Äù.</p>
    </div>

    <div class="exercise-card reveal" style="margin-top: 0;">
      <div class="tab-row" id="motifTabs"></div>
      <div class="tab-panel" id="motifPanel"></div>
    </div>
  </div>
</section>

<section class="author-section" id="generator">
  <div class="container">
    <div class="section-header reveal">
      <div class="section-badge">üß® Killer</div>
      <h2 class="section-title">Generator tezy + plan z ‚ÄûLalki‚Äù</h2>
      <p class="section-subtitle">Wybierz temat i stronƒô. Dostajesz tezƒô, 2 argumenty, przyk≈Çady i wniosek.</p>
    </div>

    <div class="typing-wrap reveal">
      <div class="typing-card">
        <div class="exercise-title" style="margin-bottom: .75rem;">‚öôÔ∏è Ustawienia</div>

        <label class="typing-hint" for="genTopic">Temat / problem:</label>
        <select id="genTopic" class="fill-select" style="width:100%; padding:.8rem 1rem; border-radius:14px;">
          <option value="idealizm">Czy idealizm pomaga czy niszczy cz≈Çowieka?</option>
          <option value="milosc">Czy mi≈Ço≈õƒá mo≈ºe usprawiedliwiaƒá wybory bohatera?</option>
          <option value="awans">Czy awans spo≈Çeczny jest mo≈ºliwy bez utraty siebie?</option>
          <option value="pieniadz">Czy pieniƒÖdz daje szczƒô≈õcie?</option>
          <option value="spoleczenstwo">Czy spo≈Çecze≈Ñstwo mo≈ºe z≈Çamaƒá jednostkƒô?</option>
        </select>

        <label class="typing-hint" for="genSide" style="margin-top: .75rem;">Twoje stanowisko:</label>
        <select id="genSide" class="fill-select" style="width:100%; padding:.8rem 1rem; border-radius:14px;">
          <option value="tak">TAK (zgadzam siƒô z tezƒÖ)</option>
          <option value="nie">NIE (polecam)</option>
        </select>

        <div style="display:flex; gap:.75rem; flex-wrap:wrap; margin-top: 1rem;">
          <button class="btn btn-primary" onclick="generate()">Generuj ‚úì</button>
          <button class="btn btn-secondary" onclick="copyPlan()">Kopiuj plan</button>
        </div>

        <p class="typing-hint" style="margin-top: .9rem; margin-bottom:0;">
          Tip: jak dodasz drugi utw√≥r (kontekst) ‚Äî masz +punkty. W planie zostawi≈Çem miejsce na ‚Äûdrugi przyk≈Çad‚Äù.
        </p>
      </div>

      <div class="typing-card">
        <div class="exercise-title" style="margin-bottom: .75rem;">üßæ Wynik</div>
        <pre id="genOut" class="code" style="white-space:pre-wrap; margin:0;">Wybierz temat i kliknij ‚ÄûGeneruj‚Äù.</pre>
      </div>
    </div>
  </div>
</section>

<section class="quiz-section" id="quiz">
  <div class="container">
    <div class="section-header reveal">
      <div class="section-badge">üéØ Sprawd≈∫ siƒô</div>
      <h2 class="section-title">Quiz: ‚ÄûLalka‚Äù (pod maturƒô)</h2>
      <p class="section-subtitle">Odpowiedz, a potem dopiero ‚ÄûNastƒôpne‚Äù. Wynik policzy siƒô na ko≈Ñcu.</p>
    </div>

    <div class="quiz-container">
      <div class="quiz-progress" id="quizProgress"></div>
      <div class="quiz-card" id="quizCard">
        <div class="quiz-question-number">Pytanie <span id="currentQuestion">1</span> z <span id="totalQuestions">0</span></div>
        <h3 class="quiz-question" id="quizQuestion"></h3>
        <div class="quiz-options" id="quizOptions"></div>
        <div class="quiz-feedback" id="quizFeedback">
          <h4 id="feedbackTitle"></h4>
          <p id="feedbackText"></p>
        </div>
        <div class="quiz-actions">
          <button class="btn btn-secondary" id="prevBtn" onclick="prevQuestion()" disabled>‚Üê Poprzednie</button>
          <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">Nastƒôpne ‚Üí</button>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="flashcards-section" id="fiszki">
  <div class="container">
    <div class="section-header reveal">
      <div class="section-badge">üÉè Powt√≥rka</div>
      <h2 class="section-title">Fiszki</h2>
      <p class="section-subtitle">Kliknij fiszkƒô, aby zobaczyƒá odpowied≈∫. ‚ÄûUmiem‚Äù = dodaje do opanowanych.</p>
    </div>
    <div class="flashcard-container">
      <div class="flashcard" id="flashcard" onclick="flipCard()">
        <div class="flashcard-face flashcard-front">
          <h3 id="flashcardQuestion">‚Ä¶</h3>
          <p>Kliknij, aby zobaczyƒá odpowied≈∫</p>
        </div>
        <div class="flashcard-face flashcard-back">
          <p id="flashcardAnswer">‚Ä¶</p>
        </div>
      </div>
      <div class="flashcard-nav" style="gap: 0.75rem;">
        <button class="btn btn-secondary" onclick="prevCard()">‚Üê Poprzednia</button>
        <button class="btn btn-secondary" onclick="speakCurrentCard()">üîä Odczytaj</button>
        <button class="btn btn-primary" onclick="markCurrentMastered()">Umiem ‚úì</button>
        <button class="btn btn-primary" onclick="nextCard()">Nastƒôpna ‚Üí</button>
      </div>
      <div class="flashcard-counter">
        Fiszka <span id="currentCard">1</span> z <span id="totalCards">0</span>
      </div>
    </div>
  </div>
</section>

<section class="author-section" id="typing">
  <div class="container">
    <div class="section-header reveal">
      <div class="section-badge">‚å®Ô∏è Speed</div>
      <h2 class="section-title">Typing sprint</h2>
      <p class="section-subtitle">Has≈Ço ‚Üí wpisujesz odpowied≈∫. Enter = sprawd≈∫. Shift+Enter = poka≈º odpowied≈∫.</p>
    </div>

    <div class="typing-wrap reveal">
      <div class="typing-card">
        <div class="typing-prompt" id="typingPrompt">‚Ä¶</div>
        <div class="typing-hint" id="typingHint">Wpisz odpowied≈∫ (bez cudzys≈Çow√≥w). Przyk≈Çad: ‚ÄûWokulski‚Äù.</div>
        <input class="typing-input" id="typingInput" autocomplete="off" placeholder="np. Wokulski" />
        <div style="display:flex; gap:0.75rem; flex-wrap:wrap; margin-top: 1rem;">
          <button class="btn btn-secondary" onclick="speakTyping()">üîä Odczytaj</button>
          <button class="btn btn-primary" onclick="checkTyping()">Sprawd≈∫ ‚úì</button>
          <button class="btn btn-secondary" onclick="skipTyping()">Pomi≈Ñ ‚Üí</button>
          <button class="btn btn-secondary" onclick="resetTyping()">Reset</button>
        </div>
        <p id="typingFeedback" style="margin-top: 0.85rem; color: var(--text-secondary);"></p>
      </div>

      <div class="typing-card">
        <div class="exercise-title" style="margin-bottom: 0.5rem;">üìä Statystyki</div>
        <div class="stat-grid">
          <div class="stat"><div class="k">Poprawne</div><div class="v" id="statOk">0</div></div>
          <div class="stat"><div class="k">B≈Çƒôdne</div><div class="v" id="statBad">0</div></div>
          <div class="stat"><div class="k">Streak</div><div class="v" id="statStreak">0</div></div>
          <div class="stat"><div class="k">Najlepszy</div><div class="v" id="statBest">0</div></div>
        </div>

        <div class="exercise-card" style="margin-top:1rem;">
          <div class="exercise-title" style="margin-bottom: 0.5rem;">üß† Metoda: ‚Äû1 zdanie ‚Äì 1 argument‚Äù</div>
          <p class="fill-line" style="margin:0;">
            Po ka≈ºdej poprawnej odpowiedzi dopowiedz w g≈Çowie 1 zdanie: <i>‚ÄûTo mi siƒô przyda w temacie o‚Ä¶ poniewa≈º‚Ä¶‚Äù</i>.
            To buduje odruch ≈ÇƒÖczenia faktu z tezƒÖ ‚Äî dok≈Çadnie to, co egzaminator chce zobaczyƒá.
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

<footer>
  <div class="footer-logo">
    <div class="footer-logo-icon">üß™</div>
    <div class="footer-logo-text">ViralloLab</div>
  </div>
  <p class="footer-copy">
    Interaktywna lekcja maturalna ‚Ä¢ ‚ÄûLalka‚Äù ‚Ä¢ wykonanie:
    <a href="https://staberek.com" target="_blank" rel="noreferrer">Staberek</a>
    (<a href="https://staberek.com" target="_blank" rel="noreferrer">Kacper Stabrawa</a>)
  </p>
</footer>

<div class="toast" id="toast"></div>

<script>
// ¬© ViralloLab ‚Äì autorski komponent ViralloLab 2025

// Polyfill: replaceAll (dla starszych Safari)
if (!String.prototype.replaceAll) {
  // eslint-disable-next-line no-extend-native
  String.prototype.replaceAll = function(search, replacement){
    return this.split(search).join(replacement);
  };
}

// ----------------- TOAST -----------------
function toast(msg, small){
  const el = document.getElementById("toast");
  el.innerHTML = small ? `<b>${msg}</b><div style="opacity:.85">${small}</div>` : `<b>${msg}</b>`;
  el.classList.add("show");
  clearTimeout(toast._t);
  toast._t = setTimeout(()=>el.classList.remove("show"), 2400);
}

// ----------------- PROGRESS + REVEAL -----------------
window.addEventListener('scroll', () => {
  const winScroll = document.documentElement.scrollTop;
  const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
  document.getElementById('navProgress').style.width = (height>0 ? (winScroll / height * 100) : 0) + '%';
}, {passive:true});

function revealOnScroll() {
  document.querySelectorAll('.reveal').forEach(el => {
    if (el.getBoundingClientRect().top < window.innerHeight - 100) el.classList.add('active');
  });
}
window.addEventListener('scroll', revealOnScroll, {passive:true});
revealOnScroll();

// ----------------- DATA -----------------

    // ----------------- DANE -----------------

    const characters = [
      {
        id: "wokulski",
        name: "Stanis≈Çaw Wokulski",
        badge: "üíº G≈Å√ìWNY",
        short: "Kupiec, samouk, cz≈Çowiek rozdarty miƒôdzy pozytywizmem (praca) a romantyzmem (mi≈Ço≈õƒá).",
        full: `
<b>Rdze≈Ñ postaci:</b> awans dziƒôki pracy + kapita≈Ç, ale psychicznie ‚Äûromantyk‚Äù.<br/>
<b>Co pamiƒôtaƒá:</b> idealizuje Izabelƒô, pr√≥buje ‚Äûkupiƒá‚Äù miejsce w arystokracji, przegrywa z hierarchiƒÖ i w≈Çasnymi emocjami.<br/>
<b>Pod rozprawkƒô:</b> ≈õwietny do temat√≥w o <u>mi≈Ço≈õci</u>, <u>awansie</u>, <u>z≈Çudzeniach</u>, <u>konflikcie rozum‚Äìuczucie</u>, <u>samotno≈õci</u>.<br/>
<b>Mini-hak (scena):</b> inwestycje i wej≈õcie do salon√≥w ‚Üí pokazuje, ≈ºe pieniƒÖdz ‚â† szacunek.`
      },
      {
        id: "izabela",
        name: "Izabela ≈Åƒôcka",
        badge: "üëë ARYSTOKRACJA",
        short: "Idealizowana ‚Äûksiƒô≈ºniczka‚Äù ‚Äî wychowana w kulcie pozor√≥w i klasy.",
        full: `
<b>Rdze≈Ñ postaci:</b> poz√≥r, dystans, status spo≈Çeczny jako religia.<br/>
<b>Co pamiƒôtaƒá:</b> przyjmuje pomoc Wokulskiego, ale nie widzi w nim r√≥wnego; traktuje go jak ‚Äû≈õrodek‚Äù.<br/>
<b>Pod rozprawkƒô:</b> do temat√≥w o <u>egoizmie</u>, <u>pozorach</u>, <u>nier√≥wno≈õci klas</u>, <u>idealizacji</u>.<br/>
<b>Mini-hak:</b> jej ‚Äûwra≈ºliwo≈õƒá‚Äù bywa dekoracjƒÖ ‚Äî Prus rozbraja mit arystokratycznej wy≈ºszo≈õci.`
      },
      {
        id: "rzecki",
        name: "Ignacy Rzecki",
        badge: "üìì PAMIƒòTNIK",
        short: "Stary subiekt, lojalny, idealista; ‚Äûserce‚Äù powie≈õci i kronikarz epoki.",
        full: `
<b>Rdze≈Ñ postaci:</b> uczciwo≈õƒá + wierno≈õƒá idea≈Çom (napoleo≈Ñskie marzenia).<br/>
<b>Co pamiƒôtaƒá:</b> jego pamiƒôtnik daje t≈Ço: przemianƒô epoki i rozpad dawnych marze≈Ñ.<br/>
<b>Pod rozprawkƒô:</b> do temat√≥w o <u>przyja≈∫ni</u>, <u>wierno≈õci</u>, <u>tƒôsknocie za sensem</u>, <u>zderzeniu idea≈Ç√≥w z rzeczywisto≈õciƒÖ</u>.<br/>
<b>Mini-hak:</b> pokazuje, jak ‚Äûstare‚Äù przegrywa z ‚Äûnowym‚Äù ≈õwiatem.`
      },
      {
        id: "ochocki",
        name: "Julian Ochocki",
        badge: "üî¨ POSTƒòP",
        short: "Nauka, wynalazki, przysz≈Ço≈õƒá ‚Äî kontrast do salon√≥w i gry pozor√≥w.",
        full: `
<b>Rdze≈Ñ postaci:</b> pozytywistyczny projekt: praca dla rozwoju (nie dla pozoru).<br/>
<b>Co pamiƒôtaƒá:</b> patrzy na spo≈Çecze≈Ñstwo trze≈∫wo, jest antytezƒÖ ‚Äûarystokracji dla arystokracji‚Äù.<br/>
<b>Pod rozprawkƒô:</b> do temat√≥w o <u>postƒôpie</u>, <u>marzeniach o zmianie</u>, <u>warto≈õci pracy</u>.<br/>
<b>Mini-hak:</b> zderz go z Wokulskim: rozum vs uczucie.`
      },
      {
        id: "stawska",
        name: "Helena Stawska",
        badge: "üß© KONTRAST",
        short: "Uczciwo≈õƒá, codzienny trud, normalno≈õƒá ‚Äî ‚Äûzdrowa‚Äù alternatywa wobec Izabeli.",
        full: `
<b>Rdze≈Ñ postaci:</b> praca, odpowiedzialno≈õƒá, moralno≈õƒá bez teatru salon√≥w.<br/>
<b>Pod rozprawkƒô:</b> do temat√≥w o <u>prawdziwych warto≈õciach</u>, <u>godno≈õci</u>, <u>krzywdzie i plotce</u>.<br/>
<b>Mini-hak:</b> zestawienie ze ≈õwiatem ≈Åƒôckich obna≈ºa fa≈Çsz elit.`
      },
      {
        id: "zaslawska",
        name: "Prezesowa Zas≈Çawska",
        badge: "üåø ROZSƒÑDEK",
        short: "Do≈õwiadczona, trze≈∫wa obserwatorka; widzi Wokulskiego i mechanizmy klasowe.",
        full: `
<b>Rdze≈Ñ postaci:</b> mƒÖdro≈õƒá ≈ºyciowa + dystans do salon√≥w.<br/>
<b>Pod rozprawkƒô:</b> do temat√≥w o <u>ocenie spo≈Çecze≈Ñstwa</u>, <u>rozsƒÖdku</u>, <u>dojrza≈Ço≈õci</u>.<br/>
<b>Mini-hak:</b> m√≥wi wiƒôcej o ≈õwiecie ni≈º sami jego uczestnicy.`
      },
      {
        id: "leccy",
        name: "Tomasz ≈Åƒôcki",
        badge: "üí∏ D≈ÅUGI",
        short: "Ojciec Izabeli; symbol upadku arystokracji ‚Äî d≈Çugi i ≈ºycie ponad stan.",
        full: `
<b>Rdze≈Ñ postaci:</b> klasa ‚Äûz tytu≈Çu‚Äù, ale bez realnej si≈Çy ekonomicznej.<br/>
<b>Pod rozprawkƒô:</b> do temat√≥w o <u>pozorach</u>, <u>kryzysie elit</u>, <u>pieniƒÖdzu</u>.`
      },
      {
        id: "krzeszowska",
        name: "Baronowa Krzeszowska",
        badge: "‚öñÔ∏è KONFLIKT",
        short: "Zazdro≈õƒá, obsesje, procesy ‚Äî pokazuje toksyczne relacje i spo≈ÇecznƒÖ hipokryzjƒô.",
        full: `
<b>Rdze≈Ñ postaci:</b> emocje, ura≈ºona duma, plotka jako bro≈Ñ.<br/>
<b>Pod rozprawkƒô:</b> do temat√≥w o <u>zazdro≈õci</u>, <u>krzywdzie</u>, <u>spo≈Çecznych mechanizmach</u>.`
      },
      {
        id: "starski",
        name: "Kazimierz Starski",
        badge: "üé≠ ISKRA",
        short: "Katalizator upadku z≈Çudze≈Ñ Wokulskiego ‚Äî salonowa gra i cynizm.",
        full: `
<b>Rdze≈Ñ postaci:</b> ‚Äû≈Çatwo≈õƒá‚Äù arystokracji: flirty, pozory, brak konsekwencji.<br/>
<b>Pod rozprawkƒô:</b> do temat√≥w o <u>prawdzie</u>, <u>z≈Çamanych idea≈Çach</u>, <u>rozczarowaniu</u>.`
      }
    ];

    const motifs = [
      {
        id: "awans",
        label: "Awans spo≈Çeczny",
        text: "Wokulski udowadnia, ≈ºe mo≈ºna siƒô ‚Äûwybiƒá‚Äù, ale nie da siƒô ≈Çatwo przebiƒá muru klas i pogardy.",
        examples: [
          "Sklep, inwestycje, wej≈õcie do salon√≥w ‚Üí pieniƒÖdz otwiera drzwi, lecz nie daje szacunku.",
          "Arystokracja korzysta z kapita≈Çu ‚Äûnowych‚Äù, ale traktuje ich jak gorszych."
        ]
      },
      {
        id: "milosc",
        label: "Mi≈Ço≈õƒá vs rozsƒÖdek",
        text: "Uczucie pcha Wokulskiego do dzia≈Ça≈Ñ wbrew logice; idealizacja ko≈Ñczy siƒô krachem.",
        examples: [
          "Idealizacja Izabeli ‚Üí ≈õlepa wiara w ‚Äûmit arystokracji‚Äù.",
          "Zazdro≈õƒá i upokorzenia ‚Üí pƒôkniƒôcie psychiczne bohatera."
        ]
      },
      {
        id: "pieniadz",
        label: "PieniƒÖdz i pozory",
        text: "PieniƒÖdz rzƒÖdzi relacjami, ale w ≈õwiecie elit liczy siƒô te≈º ‚Äûurodzenie‚Äù i reputacja.",
        examples: [
          "≈Åƒôccy: tytu≈Ç + d≈Çugi ‚Üí ≈ºycie na kredyt presti≈ºu.",
          "Wokulski: kapita≈Ç + praca ‚Üí ciƒÖgle ‚Äûnie sw√≥j‚Äù."
        ]
      },
      {
        id: "klasy",
        label: "Konflikt klas",
        text: "Prus pokazuje brutalnƒÖ hierarchiƒô: pogardƒô elit i cyniczne wykorzystywanie innych.",
        examples: [
          "Salon: ocena po pochodzeniu, nie po warto≈õci cz≈Çowieka.",
          "Plotka i reputacja jako narzƒôdzie kontroli."
        ]
      },
      {
        id: "idealizm",
        label: "Idealizm a rzeczywisto≈õƒá",
        text: "Rzecki i Wokulski wierzƒÖ w wielkie idee, ale ≈õwiat jest praktyczny, zimny, interesowny.",
        examples: [
          "Rzecki: marzenia napoleo≈Ñskie ‚Üí przegrywajƒÖ z nowƒÖ epokƒÖ.",
          "Wokulski: wiara w ‚Äûmi≈Ço≈õƒá jak z romansu‚Äù ‚Üí rozbija siƒô o real."
        ]
      },
      {
        id: "postep",
        label: "Postƒôp i nauka",
        text: "Ochocki reprezentuje pozytywistyczny motor zmian ‚Äî naukƒô i pragmatyzm.",
        examples: [
          "Kontrast: laboratorium/idee vs salony/pozory.",
          "Postƒôp jako nadzieja na sens poza mi≈Ço≈õciƒÖ i statusem."
        ]
      },
      {
        id: "samotnosc",
        label: "Samotno≈õƒá jednostki",
        text: "Bohaterowie sƒÖ samotni w swoich ≈õwiatach: Wokulski miƒôdzy klasami, Rzecki w przesz≈Ço≈õci.",
        examples: [
          "Wokulski: ‚Äûnigdzie nie pasuje‚Äù ‚Üí ani elita, ani mieszcza≈Ñstwo.",
          "Rzecki: lojalny, ale coraz bardziej niepotrzebny."
        ]
      },
      {
        id: "praca",
        label: "Praca i etos pozytywizmu",
        text: "Praca jako warto≈õƒá, ale te≈º jako narzƒôdzie walki o godno≈õƒá i miejsce w ≈õwiecie.",
        examples: [
          "Kariera Wokulskiego = dow√≥d si≈Çy pracy, samodoskonalenia.",
          "Prus pyta: czy sama praca wystarczy, gdy system jest zamkniƒôty?"
        ]
      }
    ];

    const flashcards = [
      { q: "Kim jest Stanis≈Çaw Wokulski i co go wewnƒôtrznie rozrywa?", a: "Bogaty kupiec i samouk: ≈ºyje etosem pracy (pozytywizm), ale dzia≈Ça jak romantyk w mi≈Ço≈õci do Izabeli." },
      { q: "JakƒÖ funkcjƒô ma pamiƒôtnik Rzeckiego?", a: "Daje t≈Ço epoki, pokazuje przemianƒô ≈õwiata i mentalno≈õci; buduje kontrast ‚Äûstare idea≈Çy‚Äù vs ‚Äûnowoczesno≈õƒá‚Äù." },
      { q: "Co symbolizuje arystokracja u Prusa?", a: "≈öwiat pozor√≥w, tytu≈Ç√≥w i interes√≥w; czƒôsto paso≈ºytowanie na pieniƒÖdzu ‚Äûnowych‚Äù." },
      { q: "Dlaczego Wokulski nie zostaje zaakceptowany przez salony?", a: "Bo pochodzenie i status sƒÖ wa≈ºniejsze ni≈º pieniƒÖdz i zas≈Çugi ‚Äî dzia≈Ça mur klasowy." },
      { q: "Ochocki ‚Äî co wnosi do interpretacji?", a: "Postƒôp, nauka, przysz≈Ço≈õƒá; kontrast do romantycznej idealizacji i salonowej gry." },
      { q: "Izabela ≈Åƒôcka ‚Äî cecha kluczowa maturalnie?", a: "Kult klasy i pozoru; nie traktuje Wokulskiego jak r√≥wnego, choƒá korzysta z jego pomocy." },
      { q: "Motyw: mi≈Ço≈õƒá vs rozsƒÖdek ‚Äî przyk≈Çad z powie≈õci?", a: "Wokulski podejmuje ryzykowne decyzje (inwestycje, wej≈õcie do salon√≥w) g≈Ç√≥wnie ‚Äûpod Izabelƒô‚Äù." },
      { q: "Motyw: awans spo≈Çeczny ‚Äî teza w 1 zdaniu?", a: "Awans jest mo≈ºliwy ekonomicznie, ale spo≈Çecznie ograniczony przez hierarchiƒô i pogardƒô elit." },
      { q: "Co oznacza ‚Äûkonflikt klas‚Äù w 'Lalce'?", a: "Sta≈Çe napiƒôcie: mieszcza≈Ñstwo/nowi bogaci vs arystokracja; ocena po pochodzeniu." },
      { q: "Stawska ‚Äî po co jest w powie≈õci?", a: "Jako kontrast: uczciwo≈õƒá i normalno≈õƒá vs salon i pozory; pokazuje innƒÖ wersjƒô kobieco≈õci." },
      { q: "Dlaczego zako≈Ñczenie jest wa≈ºne pod maturƒô?", a: "Jest otwarte ‚Äî daje pole do interpretacji: dramat jednostki i krytyka systemu spo≈Çecznego." },
      { q: "Baronowa Krzeszowska ‚Äî co pokazuje?", a: "Plotkƒô, konflikty, obsesje; spo≈Çeczne mechanizmy niszczenia reputacji." },
      { q: "Has≈Ço-klucz do Wokulskiego?", a: "‚ÄûMiƒôdzy epokami‚Äù ‚Äî pozytywistyczny czyn i romantyczne uczucie w jednym cz≈Çowieku." },
      { q: "Has≈Ço-klucz do Rzeckiego?", a: "‚ÄûWierno≈õƒá‚Äù ‚Äî ludziom, pracy, idea≈Çom, kt√≥re odchodzƒÖ." },
      { q: "Co Prus krytykuje najmocniej?", a: "Hipokryzjƒô i paso≈ºytnictwo elit + system klasowy, kt√≥ry blokuje uczciwych." },
      { q: "Jak u≈ºyƒá 'Lalki' jako kontekstu do tematu o marzeniach?", a: "Marzenia Wokulskiego/Rzeckiego zderzajƒÖ siƒô z realno≈õciƒÖ ‚Äî idealizm bez granic bywa niszczƒÖcy." }
    ];

    const quizData = [
      {
        q: "Co najlepiej opisuje konflikt wewnƒôtrzny Wokulskiego?",
        options: ["Mi≈Ço≈õƒá vs honor", "Pozytywizm (praca) vs romantyzm (uczucie)", "Religia vs nauka", "Wojna vs pok√≥j"],
        answer: 1,
        explanation: "Wokulski dzia≈Ça jak pozytywista w pracy, ale w mi≈Ço≈õci jest romantycznym idealistƒÖ."
      },
      {
        q: "Funkcja pamiƒôtnika Rzeckiego w powie≈õci to przede wszystkim‚Ä¶",
        options: ["Komizm sytuacyjny", "T≈Ço historyczne i mentalne epoki", "Opis przyrody", "ZastƒÖpienie narratora"],
        answer: 1,
        explanation: "Pamiƒôtnik buduje kontekst i pokazuje przemianƒô ≈õwiata oraz idea≈Ç√≥w."
      },
      {
        q: "Dlaczego arystokracja jest krytykowana przez Prusa?",
        options: ["Za pracowito≈õƒá", "Za brak tytu≈Ç√≥w", "Za pozory i paso≈ºytnictwo", "Za naukowe ambicje"],
        answer: 2,
        explanation: "Elity czƒôsto ≈ºyjƒÖ reputacjƒÖ i d≈Çugami, korzystajƒÖc z cudzych pieniƒôdzy."
      },
      {
        q: "Ochocki reprezentuje w 'Lalce' przede wszystkim‚Ä¶",
        options: ["Mit romantycznego bohatera", "Postƒôp i naukƒô", "Skrajny konserwatyzm", "Moralizatorstwo"],
        answer: 1,
        explanation: "Jest figurƒÖ pozytywistycznej wiary w rozw√≥j i sens pracy dla przysz≈Ço≈õci."
      },
      {
        q: "Motyw awansu spo≈Çecznego w powie≈õci pokazuje, ≈ºe‚Ä¶",
        options: ["PieniƒÖdz zawsze zapewnia szacunek", "Awans jest niemo≈ºliwy", "Awans bywa blokowany przez hierarchiƒô klas", "Arystokracja wspiera wszystkich"],
        answer: 2,
        explanation: "Wokulski mo≈ºe wej≈õƒá finansowo, ale nie zostaje w pe≈Çni uznany spo≈Çecznie."
      },
      {
        q: "Izabela ≈Åƒôcka jest dla Wokulskiego przede wszystkim‚Ä¶",
        options: ["RealnƒÖ partnerkƒÖ", "Symbolem idea≈Çu i z≈Çudze≈Ñ", "Przyjaci√≥≈ÇkƒÖ z dzieci≈Ñstwa", "Wrogiem politycznym"],
        answer: 1,
        explanation: "Wokulski jƒÖ idealizuje, widzƒÖc w niej ‚Äûmit‚Äù klasy i piƒôkna."
      },
      {
        q: "Kt√≥ra para najlepiej oddaje o≈õ konfliktu spo≈Çecznego w 'Lalce'?",
        options: ["Ch≈Çopi vs szlachta", "Mieszcza≈Ñstwo/nowi bogaci vs arystokracja", "Duchowni vs niewierzƒÖcy", "Uczniowie vs nauczyciele"],
        answer: 1,
        explanation: "To powie≈õƒá o zderzeniu klas w mie≈õcie i o barierach awansu."
      },
      {
        q: "Helena Stawska pe≈Çni w powie≈õci rolƒô‚Ä¶",
        options: ["Antagonistki Wokulskiego", "Kontrastu moralnego dla ≈õwiata salon√≥w", "Symbolu dekadencji", "Postaci epizodycznej bez znaczenia"],
        answer: 1,
        explanation: "Stawska pokazuje uczciwo≈õƒá i codzienny trud, bez salonowej gry."
      },
      {
        q: "Otwarty fina≈Ç 'Lalki' jest wa≈ºny, bo‚Ä¶",
        options: ["Nie da siƒô go interpretowaƒá", "Pozwala dopasowaƒá interpretacjƒô pod tezƒô", "Jest czysto humorystyczny", "Dotyczy tylko wƒÖtku Ochockiego"],
        answer: 1,
        explanation: "Mo≈ºesz go czytaƒá jako dramat jednostki i/lub krytykƒô systemu."
      },
      {
        q: "Najtrafniejsza definicja ‚Äûpozor√≥w‚Äù w ≈õwiecie powie≈õci to‚Ä¶",
        options: ["Styl ubierania siƒô", "Udawanie warto≈õci poprzez tytu≈Ç i reputacjƒô", "Praca fizyczna", "Technika wynalazk√≥w"],
        answer: 1,
        explanation: "U Prusa liczy siƒô ‚Äûjak wyglƒÖdasz w oczach salonu‚Äù, nie kim jeste≈õ."
      },
      {
        q: "Co jest jednym z g≈Ç√≥wnych mechanizm√≥w kontroli spo≈Çecznej w powie≈õci?",
        options: ["Plotka i reputacja", "Prawo morskie", "Rytua≈Çy religijne", "Tajemne bractwa"],
        answer: 0,
        explanation: "Plotka niszczy ludzi, a reputacja decyduje o ‚Äûbyciu‚Äù w towarzystwie."
      },
      {
        q: "Kt√≥re zdanie najlepiej pasuje jako teza do 'Lalki' w temacie o idealizmie?",
        options: [
          "Idealizm zawsze daje szczƒô≈õcie.",
          "Idealizm bez granic mo≈ºe prowadziƒá do autodestrukcji.",
          "Idealizm jest zbƒôdny w ≈ºyciu.",
          "Idealizm dotyczy tylko nauki."
        ],
        answer: 1,
        explanation: "Wokulski (i Rzecki) pokazujƒÖ, jak idea≈Çy przegrywajƒÖ z realno≈õciƒÖ."
      }
    ];

        const typingItems = [
      { p: "G≈Ç√≥wny bohater (nazwisko):", a: "Wokulski" },
      { p: "Arystokratka ‚Äì obiekt idealizacji (imiƒô):", a: "Izabela" },
      { p: "Stary subiekt ‚Äì autor pamiƒôtnika (nazwisko):", a: "Rzecki" },
      { p: "Pozytywista od nauki i wynalazk√≥w (nazwisko):", a: "Ochocki" },
      { p: "Motyw: awans ________:", a: "spo≈Çeczny" },
      { p: "Motyw: konflikt ________:", a: "klas" },
      { p: "Motyw: pozory i ________:", a: "reputacja" },
      { p: "Etos: praca u podstaw (1 s≈Çowo):", a: "pozytywizm" },
      { p: "Przeciwie≈Ñstwo pozytywizmu (1 s≈Çowo):", a: "romantyzm" },
      { p: "Mi≈Ço≈õƒá kontra ________:", a: "rozsƒÖdek" },
      { p: "Warszawa: miejsce pracy Wokulskiego (1 s≈Çowo):", a: "sklep" },
      { p: "Czynnik, kt√≥ry ‚Äûotwiera drzwi‚Äù, ale nie daje szacunku:", a: "pieniƒÖdz" }
    ];


// ----------------- CHAR GRID -----------------
function renderChars(){
  const grid=document.getElementById("charGrid");
  grid.innerHTML = characters.map(c=>`
    <div class="vocab-card reveal" id="char-${c.id}">
      <div class="vocab-head">
        <div>
          <div class="vocab-word">${c.name}</div>
          <div class="vocab-sub">${c.badge}</div>
        </div>
        <div class="vocab-actions">
          <button class="icon-btn" title="Rozwi≈Ñ / zwi≈Ñ" onclick="toggleChar(event, '${c.id}')">‚ÜïÔ∏è</button>
        </div>
      </div>
      <div class="vocab-body" data-hidden="1" data-short="${escapeHtml(c.short)}" data-full="${escapeHtml(c.full)}">
        ${c.short}
      </div>
    </div>
  `).join("");
  revealOnScroll();
}
function escapeHtml(s) {
  return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");
}
function toggleReveal(card){
  const body = card.querySelector(".vocab-body");
  const hidden = body.dataset.hidden === "1";
  if(hidden){
    body.dataset.hidden = "0";
    body.innerHTML = body.dataset.full.replaceAll("&lt;","<").replaceAll("&gt;",">").replaceAll("&amp;","&").replaceAll("&quot;","\"").replaceAll("&#039;","'");
  } else {
    body.dataset.hidden = "1";
    body.innerHTML = body.dataset.short.replaceAll("&lt;","<").replaceAll("&gt;",">").replaceAll("&amp;","&").replaceAll("&quot;","\"").replaceAll("&#039;","'");
  }
}
function toggleChar(ev,id){
  ev.preventDefault(); ev.stopPropagation();
  const card=document.getElementById("char-"+id);
  toggleReveal(card);
}

// ----------------- MOTIF TABS -----------------
function renderMotifs(){
  const tabs=document.getElementById("motifTabs");
  const panel=document.getElementById("motifPanel");
  tabs.innerHTML = motifs.map((m,i)=>`
    <button class="tab-btn ${i===0?'active':''}" onclick="selectMotif('${m.id}')">${m.label}</button>
  `).join("");
  window.__motif = motifs[0].id;
  panel.innerHTML = motifHtml(motifs[0]);
}
function motifHtml(m){
  const ex = (m.examples||[]).map(e=>`<li>${e}</li>`).join("");
  return `
    <h3 style="font-family:'Cinzel',serif; margin:0 0 .5rem 0;">${m.label}</h3>
    <div style="color:var(--text-secondary); line-height:1.85;">${m.text}</div>
    <div style="margin-top: .9rem;">
      <div style="opacity:.85; margin-bottom:.4rem;"><b>Przyk≈Çady z utworu:</b></div>
      <ul style="margin:0; padding-left: 1.1rem; color: var(--text-primary);">${ex}</ul>
    </div>
  `;
}
function selectMotif(id){
  window.__motif = id;
  document.querySelectorAll("#motifTabs .tab-btn").forEach(b=>b.classList.remove("active"));
  const btn=[...document.querySelectorAll("#motifTabs .tab-btn")].find(b=>b.textContent===motifs.find(x=>x.id===id).label);
  if(btn) btn.classList.add("active");
  const panel=document.getElementById("motifPanel");
  panel.innerHTML = motifHtml(motifs.find(x=>x.id===id));
}

// ----------------- FILL -----------------
function checkFill(){
  const selects=[...document.querySelectorAll(".fill-select[data-answer]")];
  let ok=0;
  selects.forEach(s=>{
    const ans=s.dataset.answer;
    const val=s.value.trim();
    s.classList.remove("correct","wrong");
    if(val && val===ans){ ok++; s.classList.add("correct"); }
    else s.classList.add("wrong");
  });
  document.getElementById("fillFeedback").textContent = `Wynik: ${ok}/${selects.length}`;
  toast(ok===selects.length ? "Perfekcyjnie! üî•" : "Spoko ‚Äî popraw i jedziemy dalej.", `Wynik: ${ok}/${selects.length}`);
}
function resetFill(){
  document.querySelectorAll(".fill-select[data-answer]").forEach(s=>{ s.value=""; s.classList.remove("correct","wrong"); });
  document.getElementById("fillFeedback").textContent="";
  toast("Zresetowane.", "Uzupe≈Çnij jeszcze raz ‚úÖ");
}

// ----------------- GENERATOR -----------------
const plans = {
  idealizm: {
    tak: {
      thesis:"Idealizm mo≈ºe pomagaƒá ‚Äî daje sens, ale wymaga kontroli i kontaktu z faktami.",
      a1:"Wokulski: idealizm napƒôdza dzia≈Çanie (ambicja, praca), ale bez trze≈∫wej oceny ludzi ≈Çatwo o klƒôskƒô.",
      a2:"Rzecki: idea≈Çy dajƒÖ lojalno≈õƒá i moralny krƒôgos≈Çup, lecz mogƒÖ zniekszta≈Çcaƒá obraz ≈õwiata.",
      concl:"W ‚ÄûLalce‚Äù idealizm jest si≈ÇƒÖ ‚Äî dop√≥ki nie odcina cz≈Çowieka od rzeczywisto≈õci."
    },
    nie: {
      thesis:"Idealizm, gdy dominuje nad rozsƒÖdkiem, niszczy cz≈Çowieka ‚Äî prowadzi do z≈Çudze≈Ñ i b≈Çƒôd√≥w.",
      a1:"Wokulski: ≈õlepa wiara w ‚Äûuczucie‚Äù powoduje, ≈ºe ignoruje sygna≈Çy i pozwala sobƒÖ sterowaƒá.",
      a2:"Rzecki: romantyczne mity sprawiajƒÖ, ≈ºe ≈ºyje wspomnieniem i interpretuje fakty pod tezƒô.",
      concl:"Prus pokazuje, ≈ºe ≈õwiat nowoczesny wymaga pragmatyzmu; idealizm bez hamulc√≥w ko≈Ñczy siƒô rozczarowaniem."
    }
  },
  milosc: {
    tak: {
      thesis:"Mi≈Ço≈õƒá potrafi usprawiedliwiaƒá wybory bohatera, je≈õli prowadzi do rozwoju, a nie do utraty godno≈õci.",
      a1:"Wokulski: uczucie mobilizuje go do pracy i dzia≈Çania ‚Äî pokazuje si≈Çƒô emocji jako motoru.",
      a2:"Granica: gdy relacja opiera siƒô na pozorze i nier√≥wno≈õci (salon), mi≈Ço≈õƒá staje siƒô toksyczna.",
      concl:"Mi≈Ço≈õƒá ma sens jako warto≈õƒá ‚Äî ale nie jako ≈õlepa pogo≈Ñ za statusem."
    },
    nie: {
      thesis:"Mi≈Ço≈õƒá nie usprawiedliwia wybor√≥w, gdy prowadzi do ≈Çamania zasad i utraty siebie.",
      a1:"Wokulski: podporzƒÖdkowuje ≈ºycie Izabeli, zamiast widzieƒá cz≈Çowieka ‚Äî gubi w≈Çasne cele.",
      a2:"Mechanizm salonu: uczucie bywa wykorzystane jako narzƒôdzie nacisku i gry spo≈Çecznej.",
      concl:"W ‚ÄûLalce‚Äù mi≈Ço≈õƒá bez wzajemno≈õci staje siƒô ≈∫r√≥d≈Çem upokorzenia i klƒôski."
    }
  },
  awans: {
    tak: {
      thesis:"Awans spo≈Çeczny jest mo≈ºliwy, ale czƒôsto wymaga ceny: kompromis√≥w i zderzenia z uprzedzeniami.",
      a1:"Wokulski: kapita≈Ç daje wp≈Çywy i dostƒôp, lecz nie usuwa barier mentalnych arystokracji.",
      a2:"Kontrast: praca i kompetencje majƒÖ warto≈õƒá w handlu, ale w salonie liczy siƒô nazwisko.",
      concl:"Prus pokazuje awans jako trudny proces ‚Äî zale≈ºny od struktur spo≈Çecznych."
    },
    nie: {
      thesis:"Awans spo≈Çeczny w ‚ÄûLalce‚Äù jest pozorny ‚Äî pieniƒÖdz nie gwarantuje r√≥wno≈õci ani szacunku.",
      a1:"Wokulski: traktowany jak narzƒôdzie finansowe; granica klasowa pozostaje.",
      a2:"≈öwiat salonu: ‚Äûforma‚Äù i pochodzenie blokujƒÖ prawdziwƒÖ integracjƒô.",
      concl:"U Prusa awans bez zmiany mentalno≈õci spo≈Çecze≈Ñstwa jest iluzjƒÖ."
    }
  },
  pieniadz: {
    tak: {
      thesis:"PieniƒÖdz mo≈ºe dawaƒá poczucie bezpiecze≈Ñstwa i mo≈ºliwo≈õci, ale sam nie tworzy szczƒô≈õcia.",
      a1:"Wokulski: bogactwo otwiera drzwi i daje sprawczo≈õƒá (pomoc innym, inwestycje).",
      a2:"Jednak: brak sensu i relacji powoduje pustkƒô ‚Äî pieniƒÖdz nie ‚Äûleczy‚Äù samotno≈õci.",
      concl:"W ‚ÄûLalce‚Äù kapita≈Ç to narzƒôdzie, nie odpowied≈∫ na potrzebƒô sensu."
    },
    nie: {
      thesis:"PieniƒÖdz nie daje szczƒô≈õcia ‚Äî mo≈ºe wrƒôcz uwydatniaƒá samotno≈õƒá i fa≈Çsz relacji.",
      a1:"Wokulski: bogactwo przyciƒÖga interesowno≈õƒá; nie kupi szczerego szacunku.",
      a2:"Salon: relacje czƒôsto opierajƒÖ siƒô na statusie, nie na cz≈Çowieku.",
      concl:"Prus pokazuje, ≈ºe warto≈õci i godno≈õƒá sƒÖ wa≈ºniejsze ni≈º stan konta."
    }
  },
  spoleczenstwo: {
    tak: {
      thesis:"Spo≈Çecze≈Ñstwo mo≈ºe z≈Çamaƒá jednostkƒô, gdy dzia≈Ça poprzez pogardƒô, wykluczenie i presjƒô norm.",
      a1:"Wokulski: zderza siƒô z barierƒÖ klasowƒÖ i grƒÖ pozor√≥w ‚Äî to niszczy jego wiarƒô w ludzi.",
      a2:"Panorama: mechanizmy epoki utrudniajƒÖ uczciwe ≈ºycie (plotka, interes, hierarchia).",
      concl:"W ‚ÄûLalce‚Äù cz≈Çowiek przegrywa nie tylko z sobƒÖ, ale i z systemem relacji spo≈Çecznych."
    },
    nie: {
      thesis:"Spo≈Çecze≈Ñstwo wp≈Çywa na jednostkƒô, ale nie musi jej z≈Çamaƒá ‚Äî kluczowe sƒÖ granice i ≈õwiadomo≈õƒá.",
      a1:"Kontrprzyk≈Çad: postawy pracy i rozwoju (Ochocki) pokazujƒÖ mo≈ºliwo≈õƒá wyj≈õcia poza salon.",
      a2:"Wokulski przegrywa te≈º przez w≈Çasne decyzje ‚Äî to nie wy≈ÇƒÖcznie ‚Äûwina ≈õwiata‚Äù.",
      concl:"Prus pokazuje napiƒôcie: presja jest silna, ale odpowiedzialno≈õƒá jednostki te≈º istnieje."
    }
  }
};

function generate(){
  const topic=document.getElementById("genTopic").value;
  const side=document.getElementById("genSide").value;
  const p=(plans[topic] && plans[topic][side]) ? plans[topic][side] : null;
  if(!p) return;
  const out =
`TEZA:
- ${p.thesis}

ARGUMENT 1 (LALKA):
- ${p.a1}
  Przyk≈Çad: (wpisz scenƒô / sytuacjƒô) __________________________

ARGUMENT 2 (LALKA lub KONTEKST):
- ${p.a2}
  Drugi przyk≈Çad (inna lektura / film / historia): __________________________

WNIOSKI:
- ${p.concl}`;
  document.getElementById("genOut").textContent = out;
  toast("Wygenerowane ‚úÖ", "Masz tezƒô + plan. Dopisz 1‚Äì2 sceny i jedziesz.");
}
function copyPlan(){
  const text=document.getElementById("genOut").textContent.trim();
  if(!text || text==="Wybierz temat i kliknij ‚ÄûGeneruj‚Äù.") return toast("Najpierw wygeneruj üôÇ");
  navigator.clipboard?.writeText(text).then(()=>toast("Skopiowane ‚úÖ","Plan w schowku"));
}

// ----------------- QUIZ -----------------
let currentQuestionIndex = 0;
let quizScore = 0;
let selectedOptionIndex = null;

function loadQuiz(){
  document.getElementById('totalQuestions').textContent = quizData.length;
  renderQuestion();
}
function renderQuestion(){
  const q = quizData[currentQuestionIndex];
  document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
  document.getElementById('quizQuestion').textContent = q.q;

  const optionsContainer = document.getElementById('quizOptions');
  optionsContainer.innerHTML = '';
  selectedOptionIndex = null;

  q.options.forEach((opt, idx) => {
    const btn = document.createElement('button');
    btn.className = 'quiz-option';
    btn.textContent = opt;
    btn.onclick = () => selectOption(idx);
    optionsContainer.appendChild(btn);
  });

  document.getElementById('quizFeedback').classList.remove('show');
  document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
  document.getElementById('nextBtn').textContent = currentQuestionIndex === quizData.length - 1 ? 'Zako≈Ñcz' : 'Nastƒôpne ‚Üí';

  const progress = ((currentQuestionIndex) / quizData.length) * 100;
  document.getElementById('quizProgress').style.width = progress + '%';
}
function selectOption(idx){
  if (selectedOptionIndex !== null) return;
  selectedOptionIndex = idx;
  const q = quizData[currentQuestionIndex];
  const options = document.querySelectorAll('.quiz-option');
  options.forEach(o => o.disabled = true);

  const correct = q.correct;
  options[correct].classList.add('correct');
  if (idx !== correct) options[idx].classList.add('wrong');
  else quizScore++;

  const fb = document.getElementById('quizFeedback');
  fb.classList.add('show');
  document.getElementById('feedbackTitle').textContent = idx === correct ? 'Dobrze ‚úÖ' : 'Nie tym razem ‚úçÔ∏è';
  document.getElementById('feedbackText').textContent = q.exp || '';

  toast(idx === correct ? "Quiz: dobrze ‚úÖ" : "Quiz: poprawione ‚úçÔ∏è", `Wynik: ${quizScore}/${currentQuestionIndex+1}`);
}
function nextQuestion(){
  if (selectedOptionIndex === null) return toast("Najpierw odpowiedz üôÇ","Quiz liczy siƒô dopiero po wyborze opcji.");
  if (currentQuestionIndex < quizData.length - 1) {
    currentQuestionIndex++;
    renderQuestion();
  } else {
    document.getElementById('quizProgress').style.width = '100%';
    const pct = Math.round((quizScore/quizData.length)*100);
    document.getElementById('quizQuestion').textContent = `Koniec! Wynik: ${quizScore}/${quizData.length} (${pct}%)`;
    document.getElementById('quizOptions').innerHTML = '';
    document.getElementById('quizFeedback').classList.add('show');
    document.getElementById('feedbackTitle').textContent = pct>=80 ? "Matura vibe üî•" : (pct>=60 ? "Jest okej ‚úÖ" : "Jeszcze raz i bƒôdzie git üí™");
    document.getElementById('feedbackText').textContent = "Zjed≈∫ do fiszek i typing sprintu ‚Äî tam najszybciej wchodzi.";
    document.getElementById('nextBtn').disabled = true;
    toast("Quiz zako≈Ñczony üéâ", `Wynik: ${quizScore}/${quizData.length}`);
  }
}
function prevQuestion(){
  if (currentQuestionIndex === 0) return;
  currentQuestionIndex--;
  // cofniƒôcie nie cofa punkt√≥w ‚Äî celowo (uczenie, nie karanie).
  renderQuestion();
}

// ----------------- FLASHCARDS -----------------
let currentCardIndex = 0;
let flipped = false;
const masteredKey = "virallolab_lalka_mastered";
let mastered = new Set(JSON.parse(localStorage.getItem(masteredKey) || "[]"));

function loadFlashcards(){
  document.getElementById('totalCards').textContent = flashcards.length;
  showCard(0);
}
function showCard(idx){
  currentCardIndex = (idx + flashcards.length) % flashcards.length;
  const c = flashcards[currentCardIndex];
  document.getElementById('flashcardQuestion').textContent = c.q;
  document.getElementById('flashcardAnswer').textContent = c.a;
  document.getElementById('currentCard').textContent = currentCardIndex + 1;
  const card = document.getElementById('flashcard');
  flipped = false;
  card.classList.remove('flipped');
}
function flipCard(){
  const card = document.getElementById('flashcard');
  flipped = !flipped;
  card.classList.toggle('flipped', flipped);
}
function nextCard(){ showCard(currentCardIndex+1); }
function prevCard(){ showCard(currentCardIndex-1); }
function markCurrentMastered(){
  const id = currentCardIndex;
  if(mastered.has(id)) mastered.delete(id); else mastered.add(id);
  localStorage.setItem(masteredKey, JSON.stringify([...mastered]));
  toast(mastered.has(id) ? "Dodano do opanowanych ‚úÖ" : "Usuniƒôto z opanowanych", flashcards[currentCardIndex].q);
}
function speakCurrentCard(){
  if(!('speechSynthesis' in window)) return toast("Brak TTS üòø", "Spr√≥buj Chrome/Edge.");
  const c=flashcards[currentCardIndex];
  const u = new SpeechSynthesisUtterance(`${c.q}. Odpowied≈∫: ${c.a}`);
  u.lang='pl-PL';
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

// ----------------- TYPING -----------------
let typingIndex = 0;
let statOk=0, statBad=0, statStreak=0, statBest=0;

function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; }
  return arr;
}
let typingPool = shuffle([...typingItems]);

function showTyping(){
  const it = typingPool[typingIndex % typingPool.length];
  document.getElementById('typingPrompt').textContent = `Has≈Ço: ${it.p}`;
  document.getElementById('typingHint').textContent = "Wpisz odpowied≈∫ (najczƒô≈õciej 1 s≈Çowo).";
  const inp=document.getElementById('typingInput');
  inp.value="";
  // (bez auto-focusu, ≈ºeby strona nie przewija≈Ça na iPhone)
  document.getElementById('typingFeedback').textContent = "";
}
function norm(s){ return String(s||"").trim().toLowerCase().replaceAll("≈Ç","l").replaceAll("√≥","o").replaceAll("ƒÖ","a").replaceAll("ƒô","e").replaceAll("≈õ","s").replaceAll("ƒá","c").replaceAll("≈º","z").replaceAll("≈∫","z").replaceAll("≈Ñ","n"); }
function updateStats(){
  document.getElementById('statOk').textContent = statOk;
  document.getElementById('statBad').textContent = statBad;
  document.getElementById('statStreak').textContent = statStreak;
  document.getElementById('statBest').textContent = statBest;
}
function checkTyping(show=false){
  const it = typingPool[typingIndex % typingPool.length];
  const inp=document.getElementById('typingInput');
  const val=inp.value;
  if(show){
    document.getElementById('typingFeedback').textContent = `Odp: ${it.a}`;
    toast("Poka≈º odpowied≈∫ üëÄ", it.a);
    return;
  }
  const ok = norm(val)===norm(it.a);
  if(ok){
    statOk++; statStreak++; statBest=Math.max(statBest, statStreak);
    document.getElementById('typingFeedback').textContent = "Dobrze ‚úÖ";
    toast("Dobrze ‚úÖ", it.a);
  } else {
    statBad++; statStreak=0;
    document.getElementById('typingFeedback').textContent = `≈πle ‚úçÔ∏è Popraw: ${it.a}`;
    toast("Poprawione ‚úçÔ∏è", it.a);
  }
  updateStats();
  typingIndex++;
  setTimeout(showTyping, 260);
}
function skipTyping(){
  typingIndex++; showTyping();
}
function resetTyping(){
  typingIndex=0; statOk=0; statBad=0; statStreak=0; statBest=0;
  typingPool = shuffle([...typingItems]);
  updateStats();
  showTyping();
  toast("Typing zresetowany.", "Nowa kolejno≈õƒá pyta≈Ñ ‚úÖ");
}
function speakTyping(){
  if(!('speechSynthesis' in window)) return toast("Brak TTS üòø", "Spr√≥buj Chrome/Edge.");
  const it = typingPool[typingIndex % typingPool.length];
  const u = new SpeechSynthesisUtterance(`${it.p}. Odpowied≈∫: ${it.a}`);
  u.lang='pl-PL';
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

// keyboard shortcuts
document.addEventListener("keydown",(e)=>{
  if(e.target && e.target.id==="typingInput"){
    if(e.key==="Enter" && e.shiftKey){ e.preventDefault(); checkTyping(true); }
    else if(e.key==="Enter"){ e.preventDefault(); checkTyping(false); }
  }
});

// ----------------- INIT -----------------
renderChars();
renderMotifs();
loadQuiz();
loadFlashcards();
showTyping();
updateStats();
</script>
</body>
</html>
