<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b0c10" />
  <title>ViralloLab ‚Ä¢ Zbi√≥r lekcji</title>

  <style>
    :root{
      --bg:#0b0c10;
      --panel: rgba(255,255,255,.045);
      --panel2: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.10);
      --text:#e9ecf1;
      --muted: rgba(233,236,241,.72);
      --muted2: rgba(233,236,241,.55);
      --shadow: 0 20px 70px rgba(0,0,0,.55);
      --r: 18px;

      --a1:#22c55e; /* green */
      --a2:#f59e0b; /* amber */
      --a3:#a855f7; /* purple */
      --a4:#06b6d4; /* cyan */
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 700px at 20% -10%, rgba(168,85,247,.18), transparent 60%),
                  radial-gradient(900px 600px at 85% 10%, rgba(34,197,94,.15), transparent 60%),
                  radial-gradient(1000px 650px at 50% 110%, rgba(245,158,11,.10), transparent 60%),
                  var(--bg);
      color:var(--text);
      overflow-x:hidden;
    }

    .accent-line{
      position:fixed; top:0; left:0; right:0; height:3px; z-index:50;
      background: linear-gradient(90deg, var(--a1), var(--a2), var(--a3), var(--a4));
      opacity:.95;
    }

    .grain{
      pointer-events:none;
      position:fixed; inset:0; z-index:0;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.18'/%3E%3C/svg%3E");
      mix-blend-mode:soft-light;
      opacity:.28;
      transform: translateZ(0);
    }

    header{
      position:sticky; top:0; z-index:40;
      backdrop-filter: blur(14px);
      background: linear-gradient(180deg, rgba(11,12,16,.92), rgba(11,12,16,.65));
      border-bottom:1px solid rgba(255,255,255,.08);
    }

    .nav{
      max-width:1100px;
      margin:0 auto;
      padding: 14px 18px;
      display:flex;
      gap:16px;
      align-items:center;
      justify-content:space-between;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 240px;
    }
    .logo{
      width:40px; height:40px; border-radius:14px;
      display:grid; place-items:center;
      background: linear-gradient(135deg, rgba(34,197,94,.25), rgba(168,85,247,.25));
      border:1px solid rgba(255,255,255,.14);
      box-shadow: 0 14px 40px rgba(0,0,0,.35);
      font-weight:900;
      letter-spacing:.2px;
    }
    .brand h1{
      margin:0;
      font-size: 15px;
      letter-spacing:.6px;
      text-transform:uppercase;
      opacity:.95;
    }
    .brand .sub{
      font-size:12px;
      color:var(--muted2);
      margin-top:2px;
    }

    .tools{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.045);
      border:1px solid rgba(255,255,255,.09);
      color:var(--muted);
      font-size: 13px;
      white-space:nowrap;
    }

    .input{
      width: min(520px, 70vw);
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.055);
      border:1px solid rgba(255,255,255,.11);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.25);
    }
    .input input{
      width:100%;
      background:transparent;
      border:none;
      outline:none;
      color:var(--text);
      font-size:14px;
    }
    .input input::placeholder{color:rgba(233,236,241,.45)}

    select{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      color: var(--text);
      padding:10px 12px;
      border-radius: 999px;
      outline:none;
      appearance:none;
      -webkit-appearance:none;
      color-scheme: dark;
      cursor:pointer;
    }
    option{ background:#0f1116; color: var(--text); }

    main{
      position:relative;
      z-index:2;
      max-width:1100px;
      margin: 0 auto;
      padding: 26px 18px 40px;
    }

    .hero{
      padding: 34px 0 18px;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 18px;
      align-items:stretch;
    }
    @media (max-width: 920px){
      .hero{ grid-template-columns: 1fr; }
      .brand{min-width:auto}
      .input{ width: min(680px, 92vw); }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.055), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.10);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding: 18px;
    }

    .title{
      margin:0;
      font-size: clamp(28px, 4.2vw, 44px);
      letter-spacing: .6px;
      font-weight: 900;
      text-transform: uppercase;
    }
    .subtitle{
      margin: 10px 0 0;
      color: var(--muted);
      line-height: 1.6;
      font-size: 14px;
      max-width: 72ch;
    }

    .stats{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:14px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 9px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.10);
      color: rgba(233,236,241,.82);
      font-size: 13px;
      white-space:nowrap;
    }

    .grid{
      margin-top: 18px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
    }
    @media (max-width: 980px){ .grid{ grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 620px){ .grid{ grid-template-columns: 1fr; } }

    .lesson{
      position:relative;
      padding: 16px;
      border-radius: var(--r);
      background: radial-gradient(700px 300px at 20% -10%, rgba(34,197,94,.12), transparent 55%),
                  radial-gradient(600px 260px at 110% 20%, rgba(168,85,247,.12), transparent 60%),
                  rgba(255,255,255,.035);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 16px 55px rgba(0,0,0,.45);
      transition: transform .18s ease, border-color .18s ease, background .18s ease;
      overflow:hidden;
      min-height: 160px;
    }
    .lesson:hover{
      transform: translateY(-3px);
      border-color: rgba(255,255,255,.16);
      background: radial-gradient(700px 300px at 20% -10%, rgba(245,158,11,.14), transparent 55%),
                  radial-gradient(600px 260px at 110% 20%, rgba(6,182,212,.12), transparent 60%),
                  rgba(255,255,255,.04);
    }

    .lesson .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 7px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.10);
      color: rgba(233,236,241,.82);
      font-size: 12px;
      white-space:nowrap;
    }

    .lesson h3{
      margin: 10px 0 6px;
      font-size: 18px;
      letter-spacing:.2px;
      line-height:1.2;
    }
    .lesson p{
      margin:0;
      color: var(--muted);
      line-height: 1.6;
      font-size: 13px;
      min-height: 40px;
    }

    .lesson .actions{
      margin-top: 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.11);
      background: rgba(255,255,255,.055);
      color: var(--text);
      text-decoration:none;
      font-weight: 700;
      font-size: 13px;
      cursor:pointer;
      user-select:none;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
      white-space:nowrap;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.16); background: rgba(255,255,255,.07); }

    .btn.primary{
      border:none;
      background: linear-gradient(135deg, rgba(34,197,94,.95), rgba(245,158,11,.92));
      color:#0b0c10;
      box-shadow: 0 18px 40px rgba(0,0,0,.35);
    }
    .btn.primary:hover{ transform: translateY(-2px); }

    .muteline{
      margin: 22px 0 14px;
      height:1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.10), transparent);
    }

    .empty{
      text-align:center;
      padding: 20px 10px;
      color: var(--muted);
      border:1px dashed rgba(255,255,255,.16);
      border-radius: var(--r);
      background: rgba(255,255,255,.03);
    }

    footer{
      position:relative;
      z-index:2;
      max-width:1100px;
      margin: 26px auto 36px;
      padding: 0 18px;
      color: rgba(233,236,241,.60);
      font-size: 13px;
      line-height:1.7;
      text-align:center;
    }
    footer a{
      color: rgba(233,236,241,.84);
      text-decoration:none;
      border-bottom:1px solid rgba(233,236,241,.26);
    }
    footer a:hover{ border-bottom-color: rgba(233,236,241,.55); }

    .footbox{
      padding: 14px 16px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.09);
      background: rgba(255,255,255,.03);
    }

    .small{ font-size:12px; color: rgba(233,236,241,.52); }

    .reveal{ opacity:0; transform: translateY(10px); transition: opacity .55s ease, transform .55s ease; }
    .reveal.on{ opacity:1; transform: translateY(0); }

    .progress{
      position:fixed; top:3px; left:0; height:2px; width:0%;
      background: linear-gradient(90deg, var(--a1), var(--a2), var(--a3), var(--a4));
      z-index:55;
      opacity:.9;
    }

    code{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      padding: 2px 6px;
      border-radius: 8px;
      font-size: 12px;
      color: rgba(233,236,241,.86);
    }

    @media (prefers-reduced-motion: reduce){
      *{transition:none !important; scroll-behavior:auto !important}
      .reveal{opacity:1 !important; transform:none !important}
    }
  </style>
</head>
<body>
  <div class="accent-line"></div>
  <div class="progress" id="progress"></div>
  <div class="grain"></div>

  <header>
    <div class="nav">
      <div class="brand">
        <div class="logo">VL</div>
        <div>
          <h1>ViralloLab ‚Ä¢ Zbi√≥r lekcji</h1>
          <div class="sub" id="statusLine">≈Åadowanie listy‚Ä¶</div>
        </div>
      </div>

      <div class="tools">
        <div class="input" title="Szukaj po tytule/opisie">
          <span aria-hidden="true">üîé</span>
          <input id="q" type="search" placeholder="Szukaj: niemiecki, rozprawka, polska, lekcja‚Ä¶" />
        </div>

        <select id="sort">
          <option value="az">Sort: A ‚Üí Z</option>
          <option value="za">Sort: Z ‚Üí A</option>
        </select>

        <span class="chip" id="countChip">0 lekcji</span>
      </div>
    </div>
  </header>

  <main>
    <section class="hero reveal">
      <div class="card">
        <h2 class="title">Zbi√≥r lekcji</h2>
        <p class="subtitle">
          Wybierz panel i wbijaj w lekcjƒô. Lista od≈õwie≈ºa siƒô automatycznie ‚Äî jak dojdƒÖ nowe materia≈Çy, pojawiƒÖ siƒô tutaj jako nowe karty.
        </p>

        <div class="stats">
          <span class="pill">üß† ViralloLab</span>
          <span class="pill">üëë w≈Ça≈õciciel: Staberek</span>
          <span class="pill" id="lastRefresh">‚è±Ô∏è od≈õwie≈ºono: ‚Äî</span>
        </div>

        <div class="muteline"></div>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <a class="btn primary" href="https://staberek.com" target="_blank" rel="noreferrer">Staberek.com ‚Üí</a>
          <button class="btn" id="refreshBtn" type="button">Od≈õwie≈º listƒô</button>
        </div>
      </div>

      <div class="card">
        <div class="badge">‚öôÔ∏è Panel</div>
        <h3 style="margin:12px 0 6px; font-size:18px;">Szybko ‚Ä¢ czytelnie ‚Ä¢ mobilnie</h3>
        <p class="subtitle" style="margin:0">
          Wyszukaj lekcjƒô po nazwie, posortuj listƒô, skopiuj link i wy≈õlij komu≈õ. Linki zawsze prowadzƒÖ do <b>staberro.github.io</b> (niezale≈ºnie gdzie hostujesz ten index).
        </p>

        <div class="muteline"></div>
        <div class="small">
          Tip: je≈õli chcesz super-≈Çadne tytu≈Çy/opisy na panelach, dodaj w lekcji w <code>&lt;head&gt;</code>:
          <br/><code>&lt;meta name="lesson-title" content="..."&gt;</code>
          <br/><code>&lt;meta name="lesson-desc"  content="..."&gt;</code>
          <br/><code>&lt;meta name="lesson-tags"  content="Niemiecki,Jedzenie"&gt;</code>
        </div>
      </div>
    </section>

    <section class="reveal" style="margin-top:16px;">
      <div class="grid" id="grid"></div>
      <div id="empty" class="empty" style="display:none; margin-top:14px;">
        Brak pasujƒÖcych lekcji. Zmie≈Ñ filtr/szukajkƒô.
      </div>
    </section>
  </main>

  <footer class="reveal">
    <div class="footbox">
      <div>
        <b>ViralloLab</b> ‚Ä¢ wykonanie:
        <a href="https://staberek.com" target="_blank" rel="noreferrer">Staberek</a>
        (<a href="https://staberek.com" target="_blank" rel="noreferrer">dr in≈º. Kacper Stabrawa</a>)
      </div>
      <div class="small">Panel lekcji ‚Ä¢ linki gotowe do udostƒôpniania ‚Ä¢ styl: dark / premium.</div>
    </div>
  </footer>

  <script>
    // === KONFIG (TYLKO 2 RZECZY) ===
    // 1) SkƒÖd majƒÖ prowadziƒá linki "Otw√≥rz" i "Kopiuj link"
    const LESSONS_BASE_URL = "https://staberro.github.io/"; // <- tu ustawiasz docelowƒÖ bazƒô (mo≈ºe byƒá /edu/ itd.)

    // 2) ≈πr√≥d≈Ço listy plik√≥w (publiczna lista plik√≥w html z Twojej biblioteki)
    const SOURCE = { owner: "staberro", repo: "staberro.github.io", branch: "main" };

    // ≈Åadniejsze tytu≈Çy/opisy dla znanych plik√≥w (opcjonalnie)
    const OVERRIDE = {
      "lektion-3b-essen.html": {
        title: "Lektion 3b ‚Äî Essen & Getr√§nke",
        desc:  "Niemiecki: s≈Ç√≥wka o jedzeniu + fiszki, quizy, dialogi, typing sprint."
      },
      "kurs-pisania-rozprawki.html": {
        title: "Rozprawka PRO",
        desc:  "Krok po kroku: teza, argumenty, przyk≈Çady, struktura + narzƒôdzia treningowe."
      },
      "mloda-polska.html": {
        title: "M≈Çoda Polska ‚Äî repetytorium",
        desc:  "Szybka nauka: nurty, tw√≥rcy, ≈õrodki stylistyczne i kluczowe utwory."
      }
    };

    // ====== UTIL ======
    const $ = (id)=>document.getElementById(id);

    function normalizeTitle(file){
      const noExt = file.replace(/\.html?$/i, "");
      const raw = noExt.replace(/[_-]+/g," ").replace(/\s+/g," ").trim();
      const keep = new Set(["PRO","DE","PL","AI","3b","3A","3B"]);
      return raw.split(" ").map(w=>{
        if(!w) return w;
        const up = w.toUpperCase();
        if(keep.has(up)) return up === "3B" ? "3b" : up;
        if(/^\d+[a-z]$/i.test(w)) return w.toLowerCase();
        return w.charAt(0).toUpperCase() + w.slice(1);
      }).join(" ");
    }

    function detectBadge(file){
      const f = file.toLowerCase();
      if (f.includes("lektion") || f.includes("deutsch") || f.includes("essen")) return "üá©üá™ Niemiecki";
      if (f.includes("rozprawk")) return "‚úçÔ∏è Polski";
      if (f.includes("polska") || f.includes("mloda")) return "üìö Polski";
      return "üìÑ Lekcja";
    }

    function safeText(s){ return (s || "").replace(/[<>]/g, ""); }

    async function fetchJSON(url){
      const controller = new AbortController();
      const t = setTimeout(()=>controller.abort(), 9000);
      try{
        const res = await fetch(url, {signal: controller.signal, headers: {"Accept":"application/vnd.github+json"}});
        if(!res.ok) throw new Error("HTTP "+res.status);
        return await res.json();
      } finally { clearTimeout(t); }
    }

    async function fetchMetaFor(fileUrl){
      try{
        const controller = new AbortController();
        const t = setTimeout(()=>controller.abort(), 4500);
        const res = await fetch(fileUrl, {signal: controller.signal});
        clearTimeout(t);
        if(!res.ok) return null;
        const text = await res.text();
        const head = text.split("</head>")[0] || "";
        const grab = (name)=>{
          const re = new RegExp(`<meta\s+name=["']${name}["']\s+content=["']([^"']+)["']\s*\/?>`, "i");
          const m = head.match(re);
          return m ? m[1] : "";
        };
        const title = grab("lesson-title");
        const desc  = grab("lesson-desc");
        const tags  = grab("lesson-tags");
        if(!title && !desc && !tags) return null;
        return {title, desc, tags};
      }catch(e){
        return null;
      }
    }

    // ====== RENDER ======
    let lessons = [];

    function render(){
      const q = ($("q").value || "").trim().toLowerCase();
      const sort = $("sort").value;

      let items = lessons.slice();

      if(q){
        items = items.filter(x=>{
          const hay = (x.title+" "+x.desc+" "+(x.tags||"")+" "+x.file).toLowerCase();
          return hay.includes(q);
        });
      }

      items.sort((a,b)=>{
        const A = a.title.toLowerCase();
        const B = b.title.toLowerCase();
        return sort === "za" ? (B.localeCompare(A)) : (A.localeCompare(B));
      });

      $("countChip").textContent = items.length + " lekcji";
      $("empty").style.display = items.length ? "none" : "block";

      const grid = $("grid");
      grid.innerHTML = "";

      for(const it of items){
        const card = document.createElement("article");
        card.className = "lesson";
        card.innerHTML = `
          <div class="top">
            <span class="badge">${safeText(it.badge)}</span>
            <span class="badge" title="Plik">${safeText(it.file)}</span>
          </div>
          <h3>${safeText(it.title)}</h3>
          <p>${safeText(it.desc || "‚Äî")}</p>
          <div class="actions">
            <a class="btn primary" href="${it.href}" target="_self">Otw√≥rz lekcjƒô ‚Üí</a>
            <button class="btn" type="button" data-copy="${it.href}">Kopiuj link</button>
          </div>
        `;

        card.querySelector('button[data-copy]').addEventListener("click", async (e)=>{
          const url = e.currentTarget.getAttribute("data-copy");
          try{
            await navigator.clipboard.writeText(url);
            e.currentTarget.textContent = "Skopiowane ‚úì";
            setTimeout(()=>e.currentTarget.textContent="Kopiuj link", 900);
          }catch{
            prompt("Skopiuj link:", url);
          }
        });

        grid.appendChild(card);
      }
    }

    async function loadLessons(){
      $("statusLine").textContent = "≈Åadowanie listy lekcji‚Ä¶";
      $("grid").innerHTML = "";
      $("empty").style.display = "none";
      $("countChip").textContent = "‚Ä¶";

      // Docelowa baza link√≥w (≈ºeby nie by≈Ço file:/// albo edu.staberek.com/‚Ä¶)
      const base = (LESSONS_BASE_URL || "").endsWith("/") ? LESSONS_BASE_URL : (LESSONS_BASE_URL + "/");

      try{
        // Pobierz listƒô plik√≥w html (z biblioteki)
        const api = `https://api.github.com/repos/${SOURCE.owner}/${SOURCE.repo}/contents/?ref=${SOURCE.branch}`;
        const data = await fetchJSON(api);

        const htmlFiles = (Array.isArray(data) ? data : [])
          .filter(x => x && x.type === "file" && /\.html?$/i.test(x.name))
          .map(x => x.name)
          .filter(name => name.toLowerCase() !== "index.html");

        lessons = [];

        for(const file of htmlFiles){
          const ovr = OVERRIDE[file] || null;
          lessons.push({
            file,
            title: ovr?.title || normalizeTitle(file),
            desc:  ovr?.desc  || "Kliknij, ≈ºeby otworzyƒá lekcjƒô.",
            tags:  ovr?.tags  || "",
            badge: detectBadge(file),
            href:  new URL(file, base).href
          });
        }

        // Meta (≈Çadne tytu≈Çy/opisy) ‚Äî opcjonalnie
        const USE_META = true;
        if(USE_META){
          await Promise.all(lessons.map(async (it)=>{
            if(OVERRIDE[it.file]) return;
            const meta = await fetchMetaFor(it.href);
            if(meta){
              if(meta.title) it.title = meta.title;
              if(meta.desc)  it.desc  = meta.desc;
              if(meta.tags)  it.tags  = meta.tags;
            }
          }));
        }

        const now = new Date();
        $("lastRefresh").textContent = "‚è±Ô∏è od≈õwie≈ºono: " + now.toLocaleTimeString("pl-PL",{hour:"2-digit", minute:"2-digit"});
        $("statusLine").textContent = `Gotowe ‚Äî ${htmlFiles.length} lekcji`;
        render();
      }catch(err){
        $("statusLine").textContent = "Nie uda≈Ço siƒô wczytaƒá listy (offline / limit / b≈ÇƒÖd ≈∫r√≥d≈Ça).";
        lessons = [];
        $("grid").innerHTML = `
          <div class="empty" style="grid-column:1/-1;">
            <b>B≈ÇƒÖd ≈Çadowania listy lekcji.</b><br/>
            Od≈õwie≈º stronƒô albo spr√≥buj p√≥≈∫niej.
          </div>
        `;
        $("countChip").textContent = "0 lekcji";
      }
    }

    // reveal on scroll
    const io = new IntersectionObserver((entries)=>{
      for(const e of entries){
        if(e.isIntersecting) e.target.classList.add("on");
      }
    },{threshold:.12});
    document.querySelectorAll(".reveal").forEach(el=>io.observe(el));

    // scroll progress
    function updateProgress(){
      const doc = document.documentElement;
      const h = doc.scrollHeight - doc.clientHeight;
      const y = doc.scrollTop || document.body.scrollTop;
      const p = h > 0 ? (y / h) * 100 : 0;
      $("progress").style.width = p.toFixed(2) + "%";
    }
    document.addEventListener("scroll", updateProgress, {passive:true});
    updateProgress();

    $("q").addEventListener("input", ()=>render());
    $("sort").addEventListener("change", ()=>render());
    $("refreshBtn").addEventListener("click", ()=>loadLessons());

    loadLessons();
  </script>
</body>
</html>
